## **NocoBase 商用ライセンス認証ガイド**

ユーザーエクスペリエンスの向上とセキュリティの強化のため、商用ライセンスとアクティベーションプロセスを全面的にアップグレードしました。新しい認証方式は、従来の設定ファイルにユーザー名とパスワードを記入する方法に代わり、「インスタンス ID (Instance ID)」と「ライセンス キー (License Key)」のメカニズムを導入しています。

新方式の主な利点：

* **セキュリティの向上**：アカウント情報を平文で保存する必要がなくなり、機密情報漏洩のリスクを削減します。
* **プロセスの簡素化**：認証は NocoBase インスタンスに直接バインドされ、ライセンス管理と更新がより直感的で便利になります。
* **柔軟性の向上**：デプロイメント環境が変更された際、認証を簡単に再生成して新しい環境に迅速に適応できます。
* **ライセンス保護**：バックエンドライセンス管理とステータス監視により、ライセンスの実際の使用状況を監視し、不正なアプリケーションを迅速に検出・処理して、商用ライセンスの悪用を防ぐことができます。

本ガイドでは、新しい NocoBase 商用ライセンスアクティベーションプロセスの全体をご案内します。

<image src="https://static-docs.nocobase.com/undefined20250701160935956.png" >

---

## **ライセンスアクティベーション ステップガイド**

開始前に、NocoBase コミュニティ版が正常にインストール・実行されていることを確認してください。

### **ステップ1：ライセンスページにアクセスしてインスタンス ID をコピー**

1. ローカルの NocoBase アプリケーションで、`システム設定` -> `ライセンス設定 (License settings)` ページにアクセスします。
2. このページで **Instance ID** 文字列が表示されます。これは現在の実行環境の一意の識別子です。右側のコピーアイコンをクリックします。

![img_v3_02nv_a5e3edcd-d411-4dc9-8b1c-d3e29631243g](https://static-docs.nocobase.com/img_v3_02nv_a5e3edcd-d411-4dc9-8b1c-d3e29631243g.jpg)

### **ステップ2：Service プラットフォームでアプリケーションを作成してインスタンス ID を関連付け**

1. NocoBase Service プラットフォームにログインし、「アプリケーション」管理ページで「追加」ボタンをクリックします。
2. ポップアップフォームでアプリケーション情報を入力し、前のステップでコピーした `Instance ID` を `Instance ID` 入力フィールドに貼り付けて送信します。

![20250707233019](https://static-docs.nocobase.com/20250707233019.png)

### **ステップ3：ライセンス キー (License Key) を取得**

1. アプリケーションが正常に作成されたら、ライセンス一覧に戻り、対応するエントリを見つけて、操作列の「ライセンス表示」ボタンをクリックします。
2. ライセンス詳細ポップアップで「コピー」ボタンをクリックして、インスタンスに一致する **License Key** を取得します。
   ![img_v3_02nv_138161f1-8ac4-4458-81c0-8a4d0f702d8g](https://static-docs.nocobase.com/img_v3_02nv_138161f1-8ac4-4458-81c0-8a4d0f702d8g.jpg)

### **ステップ4：NocoBase でライセンス キーを設定**

1. ローカルの NocoBase `ライセンス設定 (License settings)` ページに戻ります。
2. コピーしたばかりの `License Key` を `License key` 入力フィールドに貼り付け、「送信」ボタンをクリックします。
3. 保存が成功すると、システムは「License key saved successfully, please restart the server」と表示し、ライセンス キーが正常に設定され、再起動待ちであることを示します。

![img_v3_02nv_45050542-c4dd-45b7-afdf-4a4e9fb75f4g](https://static-docs.nocobase.com/img_v3_02nv_45050542-c4dd-45b7-afdf-4a4e9fb75f4g.jpg)

### **ステップ5：アクティベーションを完了し、商用版と商用プラグインをダウンロード**

NocoBase サービスを再起動してライセンスを適用し、商用版と商用プラグインを自動的にダウンロードします。

* **Docker デプロイメントの場合**：再起動コマンド `docker compose restart app` を実行します。
* **ソースコードまたは `create-nocobase-app` デプロイメントの場合**：プロジェクトのルートディレクトリで `yarn nocobase pkg download-pro` コマンドを実行します。

サービスが再起動し、プラグインのダウンロードが成功すると、商用ライセンスがアクティベートされます。ライセンスを変更する必要がある場合は、ライセンス設定ページに再度入り、「キー変更」ボタンをクリックして上記のプロセスを繰り返してください。

---

## **ライセンス情報の確認方法**

ライセンスアクティベーション後、NocoBase インターフェースの右上角にあるライセンス情報アイコンをいつでもクリックして、現在のライセンスの詳細ステータス（ライセンスバージョン、有効期限、ドメイン一致ステータス、認証済みプラグインリストなど）を確認できます。

![20250707234415](https://static-docs.nocobase.com/20250707234415.png)

---

## デプロイメントとライセンス クイックチェックリスト

問題が発生した際は、このチェックリストに照らして迅速にトラブルシューティングできます：

- [ ]  **ステップ1：インスタンス ID の取得**
  - [ ]  NocoBase コミュニティ版/未認証版が正常に実行されている。
  - [ ]  `License settings` ページから `Instance ID` を完全にコピーしている。
- [ ]  **ステップ2：ライセンス キーの生成**
  - [ ]  Service プラットフォームでアプリケーションを作成済み。
  - [ ]  アプリケーション作成時に貼り付けた `Instance ID` が最新かつ正確である。
  - [ ]  「ライセンス表示」から `License Key` を完全にコピーしている。
- [ ]  **ステップ3：アクティベーション**
  - [ ]  `License Key` を NocoBase に貼り付けて正常に保存している。
  - [ ]  **デプロイメント方式に応じてコンテナ再起動または `download-pro` コマンドを実行済み。**（多くのユーザーがこのステップを忘れます！）
- [ ]  **検証**
  - [ ]  ライセンス情報ポップアップでステータスが「Active」（アクティブ）と表示されている。

## よくある質問 (FAQ)

インストールまたは使用中に以下のメッセージが表示される場合は、対応する解決策に従って処理してください：

### 1. `License key mismatch` - ライセンス キーが環境と一致しない

<image src="https://static-docs.nocobase.com/undefined20250701193351673.png" />

【質問】設定後に `License key mismatch`（ライセンス キー不一致）が表示されるのはなぜですか？

【回答】実行環境が変更され、「`Instance ID`」が更新されたが、アプリケーションではまだ古い「`License Key`」を使用している可能性があります。
**解決策**：本ガイドの**ステップ1**に厳密に従って、**現在の環境**の最新の `Instance ID` を取得し、その後のプロセスを完了して新しい「キー」を生成してください。

### 2. `Invalid license key` - ライセンス キーが無効

<image src="https://static-docs.nocobase.com/undefined20250701193558012.png" />

【質問】`Invalid license key` とはどういう意味ですか？

【回答】`License Key` が期限切れか、その他の理由でプラットフォームによって無効とマークされている可能性があります。
**解決策**：当社にお問い合わせいただくか、サービスプラットフォームでライセンスステータスを確認してください。必要に応じて、`License Key` を再生成して設定してください。

### 3. `Invalid license key format` - ライセンス キー形式エラー

<image src="https://static-docs.nocobase.com/undefined20250701193148501.png" />

【質問】`Invalid license key format` はどう対処すればよいですか？

【回答】貼り付けた `License Key` が不完全または形式が間違っており、システムが解析できません。
**解決策**：サービスプラットフォームに戻り、`License Key` を完全にコピーしていることを確認してから、再度貼り付けて保存してください。

### 4. システムアクセス時にライセンス情報ダイアログが強制表示される

<image src="https://static-docs.nocobase.com/undefined20250625164238000.png" width="400" />

【質問】なぜライセンス情報ダイアログが常に表示されるのですか？

【回答】このポップアップは通常、ライセンス検証の失敗を意味します。考えられる原因：

- `License Key` が破損しているか、ローカル環境と一致しない
- ライセンスが期限切れまたは無効
- `License Key` が実行中の商用プラグインバージョンと一致しない

**解決策**：最も直接的な解決方法は**ライセンス設定プロセスを完全に再実行すること**です：最新の `Instance ID` を取得し、新しい `License Key` を生成して、ローカルシステムに設定してください。

### 5. 環境移行に関する問題

【質問】サーバー/データベースを移行したら、商用プラグインが使えなくなりました。どうすればよいですか？

【回答】これは上記と同じ理由です。サーバーまたはデータベースは「身分証明書（`Instance ID`）」を構成する重要な情報であり、これらが変わると `Instance ID` も変わります。

**解決策**：上記と同様に、新しい `Instance ID` を取得し、新しい `License Key` を生成して、再度アクティベートしてください。全体のプロセスは、引っ越し後に身分証明書の住所を更新するようなものです。

### 6. プラグインが有効にならない問題

【質問】再起動しましたが、なぜ商用プラグインがまだ有効になっていないのですか？

【回答】`License Key` の設定が正しいことを確認済みの場合、以下のトラブルシューティングを試してください：

1. **ネットワーク確認**：サーバーが NocoBase の npm リポジトリにアクセスできることを確認してください。
2. **ログ確認**：NocoBase 起動時のログをチェックして、プラグインダウンロード失敗やライセンス検証失敗のエラー情報がないか確認してください。
3. **手動実行**：ソースデプロイメントの場合、`yarn nocobase pkg download-pro` コマンドを再度手動で実行し、コマンドライン出力を観察してください。

### **7. システムを起動してからライセンス認証をしましたが、商用プラグインが表示されません。**

**【問】** 先にNocoBaseシステムを起動し、その後に設定画面でライセンスキーを入力しました。認証は成功したのに、なぜ商用プラグインが表示されないのでしょうか？

**【答】** これは想定された動作であり、非常によくある質問です。NocoBaseは**サービスの起動時**にライセンスをチェックし、対応するプラグインをロードするように設計されています。システムがすでに稼働している状態でライセンス認証を完了した場合は、商用プラグインのダウンロードと有効化をトリガーするために、**NocoBaseサービスを一度再起動する**必要があります。

簡単に言えば、ライセンス認証はNocoBaseに「通行証」を渡すようなものですが、その通行証をチェックして使用するためには、再度「ドアに入る」（再起動する）必要があるのです。

お使いのデプロイ方法に応じて、対応する再起動操作を実行してください：

* **Dockerでデプロイした場合**：再起動コマンド `docker compose restart app` を実行します。
* **ソースコードまたは `create-nocobase-app` でデプロイした場合**：まず、ターミナルで実行中のサービスを停止し（通常は `Ctrl+C` を押します）、その後 `yarn start` などの起動コマンドを再度実行します。

### 8. 新旧認証方式の比較

【質問】このプロセスは従来のユーザー名/パスワード方式とどう違いますか？

【回答】従来の方式はアカウントパスワードを環境に直接露出させるもので、十分に安全ではありませんでした。新しい `License Key` システムにはいくつかの利点があります：

1. **より安全**：メインアカウントパスワードを露出する必要がなく、特定の環境にバインドされたキーのみを使用します。
2. **より柔軟**：異なるクライアントやプロジェクトに対して異なる `License Key` を生成でき、管理が容易です。
3. **より明確**：ライセンス情報が一目瞭然で、すべての詳細が Service プラットフォームに記録されます。
