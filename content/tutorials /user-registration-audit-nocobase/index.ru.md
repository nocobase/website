Этот документ предлагает два решения для реализации проверки регистрации пользователей, разработанных для различных бизнес-сценариев:

*   **Решение первое**: Подходит для сценариев, требующих простого и быстрого процесса проверки регистрации. Это решение использует функцию регистрации новых пользователей по умолчанию, назначая каждому новому пользователю роль «Гостя» без прав, которая позже вручную проверяется и обновляется администратором.
*   **Решение второе**: Подходит для сценариев, требующих гибкого, настраиваемого процесса проверки регистрации. Путем создания специальной коллекции для сбора заявок, настройки рабочего процесса проверки и активации плагина [Публичная форма](https://docs.nocobase.com/handbook/public-forms) управляется весь процесс — от подачи заявки на регистрацию до автоматического создания нового пользователя.

![](https://static-docs.nocobase.com/20250219144628.png)

---

## 1. Решение первое: Использование роли «Гость» без прав

### 1.0 Применимый сценарий

Это решение применимо, когда требования к проверке регистрации просты, используется встроенная функция регистрации, а пользователь проверяется вручную в бэкенде.

### 1.1 Включение аутентификации по паролю и разрешение регистрации пользователей

#### 1.1.1 Доступ к странице аутентификации пользователя

Сначала убедитесь, что функция регистрации пользователей включена. В системных настройках перейдите на страницу **[Аутентификация пользователя](https://docs.nocobase.com/handbook/auth/user)**, которая управляет всеми каналами аутентификации, такими как «Логин по учетной записи и паролю», «[Логин через Google](https://docs.nocobase.com/handbook/auth-oidc/example/google)» и т.д. (расширяются через плагины).

![](https://static-docs.nocobase.com/20250208164554.png)

Переключатель функции регистрации находится здесь: ![](https://static-docs.nocobase.com/20250219142005.png)

### 1.2 Настройка роли по умолчанию (Ядро)

#### 1.2.1 Создание роли «Гость»

Функция регистрации в системе включена по умолчанию, но роль по умолчанию может не соответствовать вашим требованиям.

Поэтому сначала создайте роль «Гость» в **Списке ролей**, которая будет использоваться как роль по умолчанию. Все новые зарегистрированные пользователи автоматически получат эту роль и не будут иметь прав.

![](https://static-docs.nocobase.com/20250208163521.png)

### 1.3 Настройка интерфейса проверки регистрации 

Переключитесь в режим редактирования в бэкенде и настройте простой табличный блок. Выберите коллекцию «Пользователи» для отображения и управления зарегистрированными пользователями.

![](https://static-docs.nocobase.com/20250208165406.png)

### 1.4 Тестирование процесса проверки регистрации и ручное обновление ролей

*   После регистрации нового пользователя страница изначально показывается пустой: ![](https://static-docs.nocobase.com/20250219142105.png)
*   В интерфейсе управления для пользователей, чья информация в заявке корректна, вручную измените их роль на назначенную, чтобы завершить проверку. ![](https://static-docs.nocobase.com/20250219142155.png)

### 1.5 Настройка страницы-уведомления (Опционально)

#### 1.5.1 Создание страницы (например, «Регистрация успешна») и ввод информации-уведомления

> **Опциональный шаг**: Вы можете добавить дружелюбное сообщение на этой пустой странице, например: «Ваша учетная запись находится на рассмотрении, пожалуйста, ожидайте одобрения», чтобы проинформировать пользователя о текущем статусе. ![](https://static-docs.nocobase.com/Pasted%20image%2020250208231631.png)

#### 1.5.2 Назначение прав для страницы-уведомления

Затем перейдите в настройки управления правами пользователей и назначьте эту страницу для роли «Гость». После успешной регистрации система автоматически перенаправит на эту страницу. ![](https://static-docs.nocobase.com/20250211223123.png)

### 1.6 Расширение полей коллекции «Пользователи» 

> **Опциональный шаг**: Если вам нужно собрать дополнительную информацию при регистрации для помощи в проверке, добавьте соответствующие поля (например, «Причина заявки» или «Код приглашения») в коллекцию пользователей. Этот шаг можно пропустить, если требуется только базовая проверка регистрации.

#### 1.6.1 Добавление поля заявки

Войдите в **Коллекцию «Пользователи»** и добавьте поле для записи причины регистрации заявителя или информации о коде приглашения.

![](https://static-docs.nocobase.com/20250208164321.png)

#### 1.6.2 Включение полей в разделе «Аутентификация пользователя»

![](https://static-docs.nocobase.com/20250219142231.png)

После настройки перейдите на страницу входа и нажмите **Зарегистрировать учетную запись**, чтобы увидеть соответствующее поле в форме регистрации (если настроено опциональное поле, в противном случае будет показана только базовая форма). ![](https://static-docs.nocobase.com/20250219142306.png)

#### 1.6.3 Добавление соответствующих полей на страницу проверки

Также добавьте эти поля на страницу проверки, чтобы роли пользователей можно было проверять и изменять в реальном времени.

![](https://static-docs.nocobase.com/20250208165622.png)

---

## 2. Решение второе: Отключение прямой регистрации и использование промежуточной коллекции для проверки

### 2.0 Применимый сценарий

Это решение подходит для сценариев, требующих более гибкого и настраиваемого процесса проверки регистрации.

Оно использует независимую коллекцию для информации о заявках, настройку рабочего процесса и плагин [Публичная форма](https://docs.nocobase.com/handbook/public-forms) для реализации полного процесса — от подачи заявки на регистрацию пользователем до автоматического создания пользователя. Основные шаги обеспечивают базовую функциональность и могут быть дополнительно расширены по мере необходимости.

### 2.1 Предварительная подготовка (Ядро)

#### 2.1.1 Проектирование коллекции информации о заявках

##### 2.1.1.1 Создание коллекции «Информация о заявке»

*   **Создание:**
    В бэкенде NocoBase создайте новую коллекцию для хранения информации о заявках на регистрацию пользователей.
*   **Настройка полей:**
    Добавьте в коллекцию следующие поля, убедившись, что типы полей и описания верны:

| Отображаемое имя поля | Имя поля           | Тип поля         | Описание                                                                 |
| --------------------- | ------------------ | ---------------- | ------------------------------------------------------------------------ |
| **ID**                | id                 | Целое (Integer)          | Автоматически генерируется системой; уникальный идентификатор записи     |
| **Имя пользователя**  | username           | Однострочный текст | Имя пользователя заявителя                                               |
| **Email**             | email              | Email            | Адрес электронной почты заявителя                                        |
| **Телефон**           | phone              | Телефон          | Контактный номер телефона заявителя                                      |
| **Полное имя**        | full_name          | Однострочный текст | Полное имя заявителя                                                     |
| **Причина заявки**    | application_reason | Длинный текст    | Причина или пояснение, предоставленное заявителем                        |
| **Тип пользователя**  | user_type          | Раскрывающийся список | Определяет будущий тип пользователя (напр., email, открытая регистрация) |
| **Статус**            | status             | Раскрывающийся список | Текущий статус заявки (напр., на рассмотрении, одобрена, отклонена)      |
| **Начальный пароль**  | initial_password   | Однострочный текст | Начальный пароль для нового пользователя (по умолчанию: nocobase)        |
| **Создано**           | createdAt          | Когда создано       | Отметка времени создания записи системой                                 |
| **Кем создано**       | createdBy          | Создатель       | Создатель записи по данным системы                                       |
| **Последнее обновление** | updatedAt        | Когда обновлено  | Отметка времени последнего обновления системой                           |
| **Кем обновлено**     | updatedBy          | Редактор  | Последний, кто обновил запись                                            |

*   **Просмотр структуры коллекции**
    Сверьтесь с изображением ниже, чтобы убедиться, что структура коллекции настроена правильно: ![](https://static-docs.nocobase.com/20250208145543.png)

##### 2.1.1.2 Ввод и отображение данных

*   **Настройка интерфейса проверки:**
    В главном интерфейсе настройте интерфейс управления под названием «Проверка заявок на регистрацию» для отображения поданной информации о заявках.
*   **Ввод тестовых данных:**
    Введите тестовые данные в интерфейсе управления, чтобы убедиться, что данные отображаются корректно. ![](https://static-docs.nocobase.com/20250208151429.png)

### 2.2 Настройка рабочего процесса

В этом разделе объясняется, как настроить рабочий процесс для автоматического создания новых пользователей после одобрения заявки.

#### 2.2.1 Создание рабочего процесса проверки

##### 2.2.1.1 Создание нового рабочего процесса

*   **Доступ к интерфейсу рабочего процесса:**
    В бэкенде NocoBase перейдите на страницу настройки рабочих процессов и выберите «Создать новый рабочий процесс».
*   **Выбор события-триггера:**
    Вы можете выбрать событие «[После операции](https://docs.nocobase.com/handbook/workflow/triggers/post-action)» или «[До операции](https://docs.nocobase.com/handbook/workflow/triggers/pre-action)»; здесь в качестве примера используется событие «До операции».
*   **Настройка узлов рабочего процесса**
    Создайте новый узел «Создать нового пользователя», который преобразует данные текущей формы в данные нового пользователя, настраивая сопоставление полей и логику обработки. См. изображение ниже: ![](https://static-docs.nocobase.com/20250208153202.png)

#### 2.2.2 Настройка действий формы проверки

##### 2.2.2.1 Добавление действий «Одобрить» и «Отклонить»

В форме информации о заявке добавьте два действия: «Одобрить» и «Отклонить». ![](https://static-docs.nocobase.com/20250208153302.png)

##### 2.2.2.2 Настройка функций действий

*   **Настройка действия «Одобрить»**
    *   Привяжите его к только что созданному рабочему процессу.
    *   При отправке установите поле **Статус** в значение «Одобрено». См. изображения: ![](https://static-docs.nocobase.com/20250208153429.png)![](https://static-docs.nocobase.com/20250208153409.png)
*   **Настройка действия «Отклонить»**
    *   При отправке установите поле **Статус** в значение «Отклонено».

##### 2.2.2.3 Установка правил связи действий

Чтобы предотвратить повторные операции, установите правило связи: скрывать действия, когда **Статус** не «На рассмотрении». См. изображение: ![](https://static-docs.nocobase.com/20250208153749.png)

### 2.3 Активация и настройка плагина [Публичная форма](https://docs.nocobase.com/handbook/public-forms)

Используйте плагин [Публичная форма](https://docs.nocobase.com/handbook/public-forms), чтобы позволить пользователям подавать свои заявки на регистрацию через веб-страницу.

#### 2.3.1 Активация плагина [Публичная форма](https://docs.nocobase.com/handbook/public-forms)

##### 2.3.1.1 Активация плагина

*   **Доступ к управлению плагинами**
    В интерфейсе управления бэкендом найдите и активируйте плагин «Публичная форма». См. изображение: ![](https://static-docs.nocobase.com/20250208154258.png)

#### 2.3.2 Создание и настройка публичной формы

##### 2.3.2.1 Создание публичной формы

*   **Создание новой формы**
    В управлении бэкендом создайте [Публичную форму](https://docs.nocobase.com/handbook/public-forms) для подачи пользователями заявок на регистрацию.
*   **Настройка элементов формы**
    Добавьте необходимые элементы формы (такие как имя пользователя, email, контактный номер и т.д.) и установите соответствующие правила проверки. См. изображение: ![](https://static-docs.nocobase.com/20250208155044.png)

#### 2.3.3 Активация и настройка плагина [Публичная форма](https://docs.nocobase.com/handbook/public-forms) (Ядро)

##### 2.3.3.1 Тестирование публичной формы

*   **Откройте внешнюю страницу:**
    Посетите страницу [Публичной формы](https://docs.nocobase.com/handbook/public-forms), заполните форму и отправьте данные заявки.
*   **Проверка функциональности:**
    Проверьте, корректно ли данные попадают в коллекцию информации о заявках и создается ли автоматически новый пользователь через рабочий процесс после одобрения проверки. См. результат теста:

    ![](https://static-docs.nocobase.com/202502191633-register2.gif)

### 2.4 Дальнейшие расширения (Опционально)

После завершения базового процесса регистрации и проверки вы можете расширить дополнительные функции по мере необходимости:

#### 2.4.1 Регистрация по коду приглашения

*   **Описание функции**: Ограничьте круг и количество регистрируемых пользователей, настроив код приглашения.
*   **Идея настройки**: Добавьте поле «Код приглашения» в форму заявки и используйте событие «До операции» для проверки и перехвата этого поля перед отправкой.

#### 2.4.2 Автоматические email-уведомления

*   **Описание функции**: Автоматически отправляйте письма с результатами проверки, об успешной регистрации и т.д.
*   **Идея настройки**: Создайте узел отправки email в NocoBase, чтобы добавить операции отправки писем в рабочий процесс.

---

Если вы столкнулись с какими-либо проблемами, не стесняйтесь посетить [сообщество NocoBase](https://forum.nocobase.com) или обратиться к [официальной документации](https://docs.nocobase.com). 

Надеемся, что это руководство позволит эффективно внедрить проверку регистрации пользователей с учётом ваших задач и обеспечит необходимую гибкость для будущего масштабирования. Желаем успешной реализации проекта!