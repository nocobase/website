Поздравляем с достижением финальной главы! Здесь мы представим и кратко рассмотрим мощные функции рабочих процессов в **NocoBase**. Эта функция позволяет автоматизировать задачи внутри системы, экономя время и повышая эффективность.

### Решение задачи из предыдущей главы

Прежде чем погрузиться в тему, давайте кратко вспомним решение последней задачи. Мы успешно настроили **права на комментарии** для роли "Партнер" следующим образом:

1.  **Разрешение на добавление**: Позволяет пользователям оставлять комментарии.
2.  **Разрешение на просмотр**: Позволяет пользователям просматривать все комментарии.
3.  **Разрешение на редактирование**: Пользователи могут редактировать только свои собственные комментарии.
4.  **Разрешение на удаление**: Пользователи могут удалять только свои собственные комментарии.

![](https://static-docs.nocobase.com/Solution/221734250582202415161612.png)

С этими правами Том может свободно публиковать комментарии, просматривать комментарии других и быть уверенным, что только он может редактировать или удалять свои собственные записи.

![](https://static-docs.nocobase.com/Solution/241734250764202415161912.png)

---

Теперь давайте реализуем автоматизацию: **когда исполнитель задачи изменен, система будет автоматически отправлять уведомление новому исполнителю, информируя его о передаче задачи**.

> **Рабочий процесс**: Плагин Workflow — это мощный инструмент автоматизации, обычно используемый в управлении бизнес-процессами (BPM) для проектирования и настройки бизнес-процессов на основе моделей данных.
>
> Определяя триггеры и настраивая узлы процесса, этот плагин автоматизирует поток бизнес-процессов, обеспечивая эффективное управление задачами и операции на основе данных.

### 7.1 Создание рабочего процесса

#### 7.1.1 Настройка рабочего процесса на странице администратора

Сначала переключитесь на **Роль Root** — роль системного администратора со всеми правами. Затем перейдите в [**Модуль Workflow**](https://docs.nocobase.com/handbook/workflow).

![](https://static-docs.nocobase.com/Solution/001734250860202415162112.png)

Нажмите кнопку **«Добавить»** в правом верхнем углу, чтобы создать новый рабочий процесс, и заполните основную информацию:

-   **Название**: Отправлять системное уведомление при смене исполнителя.
-   **Тип триггера**: Выберите "Событие коллекции".

![](https://static-docs.nocobase.com/Solution/151734250935202415162212.png)

#### 7.1.2 Объяснение типов триггеров

1.  [**Событие коллекции**](https://docs.nocobase.com/handbook/workflow/triggers/collection): Срабатывает при изменениях внутри коллекции (добавление, изменение, удаление). Идеально подходит для отслеживания обновлений полей задачи, например, когда изменяется исполнитель.
2.  [**Событие по расписанию**](https://docs.nocobase.com/handbook/workflow/triggers/schedule): Автоматически срабатывает в указанное время, подходит для автоматизации по расписанию.
3.  [**Событие после действия**](https://docs.nocobase.com/handbook/workflow/triggers/post-action): Привязывается к кнопке действия и срабатывает после действия пользователя, например, нажатия "сохранить" в форме.

В будущих случаях вы также можете встретить такие типы триггеров, как "Событие перед действем", "Событие действия пользователя" и "Согласование", которые можно разблокировать с помощью дополнительных плагинов.

В этом сценарии мы используем [**Событие коллекции**](https://docs.nocobase.com/handbook/workflow/triggers/collection) для отслеживания изменений поля "Исполнитель задачи" в коллекции "Задачи". После отправки рабочего процесса нажмите **Настроить**, чтобы перейти на страницу настроек рабочего процесса.

![demov3N-37.gif](https://static-docs.nocobase.com/Solution/demoE3v1-41.gif)

---

### 7.2 Настройка узлов рабочего процесса

#### 7.2.1 Установка условий срабатывания

Давайте начнем создавать процесс автоматизированного уведомления, настроив первый узел и установив условия для автоматической активации рабочего процесса при определенных обстоятельствах.

-   **Коллекция**: Выберите "Задача". (Эта коллекция запускает рабочий процесс и извлекает соответствующие данные. Мы хотим, чтобы рабочий процесс активировался при обновлении коллекции "Задачи".)
-   **Срабатывать при**: Выберите "После добавления или обновления данных".
-   **Поле триггера**: Выберите "Исполнитель задачи".
-   **Срабатывать только при соответствии условиям**: Выберите "Исполнитель задачи / ID" "существует", гарантируя, что уведомление отправляется только когда задача назначена.
-   **Предварительная загрузка связей**: Выберите "Исполнитель задачи", позволяя использовать его информацию на следующих шагах.

![](https://static-docs.nocobase.com/Solution/demoE3v1-42.gif)

---

#### 7.2.2 Включение канала "Сообщение в приложении"

Далее мы создадим узел для отправки уведомлений.

Прежде чем продолжить, нам нужно создать канал [«Сообщение в приложении»](https://docs.nocobase.com/handbook/notification-in-app-message) для уведомлений.

-   Вернитесь в Управление плагинами, выберите "Управление уведомлениями" и создайте уведомление для задач (task_message).
-   После создания канала вернитесь в рабочий процесс и добавьте узел «Уведомление».

![](https://static-docs.nocobase.com/Solution/demoE3v1-43.gif)

-   **Конфигурация узла**:
    -   **Канал**: Выберите "Уведомление о задаче".
    -   **Получатели**: Выберите «Переменная триггера / Данные триггера / Исполнитель задачи / ID», чтобы указать нового исполнителя.
    -   **Заголовок сообщения**: Введите "Напоминание о смене исполнителя".
    -   **Содержание сообщения**: Введите "Вам назначена новая задача."

После завершения нажмите переключатель в правом верхнем углу, чтобы активировать этот рабочий процесс.

![](https://static-docs.nocobase.com/Solution/demoE3v1-44N%20-1.gif)

![](https://static-docs.nocobase.com/Solution/demoE3v1-44N%20-2.gif)

![](https://static-docs.nocobase.com/Solution/551734252475202415164712.png)

Конфигурация завершена!

#### 7.2.3 Тестирование уведомления

Настал волнительный момент. Вернитесь на страницу, отредактируйте любую задачу, измените исполнителя и нажмите "Отправить". Система отправила уведомление!

![](https://static-docs.nocobase.com/Solution/001734252600202415165012.png)

![](https://static-docs.nocobase.com/Solution/141734252674202415165112.png)

---

Это базовая настройка рабочего процесса. Однако есть еще одно улучшение:

В уведомлении должна динамически подставляться информация о задаче, чтобы пользователи знали, какая именно задача была перераспределена.

### 7.3 Улучшение рабочего процесса

#### 7.3.1 Управление версиями

Вернитесь к конфигурации рабочего процесса. Вы заметите, что интерфейс рабочего процесса теперь заблокирован и не может редактироваться.

Не беспокойтесь. Нажмите на многоточие в правом верхнем углу > [**Скопировать в новую версию**](https://docs.nocobase.com/handbook/workflow/advanced/revisions), и вы перейдете на страницу конфигурации новой версии. Предыдущая версия сохраняется, поэтому, нажав кнопку **Версия**, вы можете переключаться между историческими версиями (примечание: выполненные версии рабочих процессов не могут быть изменены).

![](https://static-docs.nocobase.com/Solution/demoE3v1-45.gif)

#### 7.3.2 Улучшение содержания уведомления

Теперь давайте персонализируем уведомление, добавив детали о передаче задачи.

-   **Отредактируйте узел Уведомление**.

Измените содержание сообщения на: "Задача [Название задачи] была переназначена: [Исполнитель задачи / Имя]."

-   Используйте панель переменных справа, чтобы добавить поля "Название задачи" и "Исполнитель задачи".
-   Затем нажмите переключатель в правом верхнем углу, чтобы активировать эту версию.

![](https://static-docs.nocobase.com/Solution/demoE3v1-46.gif)

После активации обновленной версии рабочего процесса вы увидите название задачи в системном уведомлении при следующем тесте.

![](https://static-docs.nocobase.com/Solution/demoE3v1-47.gif)

---

### Резюме

Отлично! Вы успешно создали автоматизированный рабочий процесс, который срабатывает на основе изменений владельца задачи. Эта функция не только экономит время, но и улучшает командную работу. На этом этапе наша система управления задачами стала заметно мощнее.

---

### Заключение и следующие шаги

Вы с нуля собрали полноценную систему управления задачами: от создания задач и комментариев до разграничения прав, рабочих процессов и системных уведомлений.

Гибкость и расширяемость NocoBase дают широкий простор для развития: подключайте новые плагины, настраивайте функциональность под задачи и выстраивайте сложную бизнес-логику. С этими знаниями вы освоили основы и ключевые концепции NocoBase.

Мы с нетерпением ждём ваших новых идей и улучшений! Если возникнут вопросы, обращайтесь к [официальной документации NocoBase](https://docs.nocobase.com/) или присоединяйтесь к [сообществу NocoBase](https://forum.nocobase.com/) для обсуждений.

Продолжайте исследовать и раскрывайте бесконечный потенциал NocoBase!