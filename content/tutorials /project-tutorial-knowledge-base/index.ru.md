### 8.1 Добро пожаловать в новую главу

В этой главе мы приступаем к созданию базы знаний — комплексного модуля, предназначенного для управления и организации документов, задач и информации. Разработав и внедрив древовидную структуру коллекции документов, мы создадим эффективную систему для отслеживания статуса документов, управления вложениями и связывания связанных задач.

### 8.2 Изучение проектирования базы данных

#### 8.2.1 Первоначальный дизайн и создание Коллекции документов

Мы начнем с простого дизайна базы данных, создав "Коллекцию документов" для каталогизации всей информации о документах. Ключевые поля в Коллекции документов включают:

*   **Заголовок**: Однострочный текст.
*   **Содержание**: Markdown (Vditor).
*   **Статус документа**: Одиночный выбор, с вариантами: Черновик, Опубликован, В архиве, Удален.
*   **Вложение**: Поле для файлов, позволяет добавлять файлы и изображения для обогащения содержания документа.
*   **Связанная задача**: Поле связи "Многие-к-одному" для привязки документа к задаче для удобства ссылки в управлении задачами.

![](https://static-docs.nocobase.com/Solution/331734255873202415174412.png)

По мере развития нашей системы мы продолжим добавлять поля для более детального управления документами.

#### 8.2.2 Построение древовидной структуры для управления каталогом

> Древовидная коллекция (предоставляемая плагином [plugin-collection-tree](https://docs.nocobase.com/handbook/collection-tree)) — это структура коллекции, которая отражает дерево, где каждый элемент данных может иметь один или несколько дочерних элементов, а те, в свою очередь, могут иметь своих потомков.

Чтобы обеспечить организацию и иерархию, мы структурируем нашу Коллекцию документов как [**Древовидную коллекцию**](https://docs.nocobase.com/handbook/collection-tree), позволяющую осуществлять интуитивную родительско-дочернюю классификацию. Эта настройка автоматически генерирует следующие поля:

![](https://static-docs.nocobase.com/Solution/381734255938202415174512.png)

- **ID Родителя**: Идентифицирует родительский документ для текущего документа.
- **Родитель**: Поле "Многие-к-одному", устанавливающее родительско-дочерние связи.
- **Дочерние элементы**: Поле "Один-ко-многим", которое позволяет просматривать все дочерние документы под родительским документом.
  ![](https://static-docs.nocobase.com/Solution/581734256018202415174612.png)

Эти поля необходимы для поддержания иерархии каталога, поэтому не рекомендуется их изменять.

Мы также установим связь с Коллекцией задач [(Многие-к-одному)](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations/m2o), с обратным полем, чтобы списки документов можно было создавать непосредственно внутри всплывающего окна связи задачи.

### 8.3 Создание страницы управления документами

#### 8.3.1 Добавление нового меню управления документами

В главном меню системы добавьте новую страницу — «Управление документами», затем выберите подходящую иконку. Далее создайте табличный блок для нашей Коллекции документов, включив базовые действия, такие как Добавление, Удаление, Редактирование и Поиск, и введите тестовые данные для проверки дизайна коллекции данных.

![](https://static-docs.nocobase.com/Solution/111734257351202415180912.png)

#### Упражнение

1.  Добавьте родительский документ с именем «Документ 1» на странице Управления документами.
2.  Под «Документом 1» добавьте дочерний документ с именем «Глава 1».

#### 8.3.2 Преобразование в древовидное табличное представление

Я знаю, вы, наверное, удивляетесь, почему это не древовидная структура каталога.

По умолчанию табличный блок отображается как обычная таблица. Вот как преобразовать его в древовидное табличное представление:

1.  Нажмите на правый верхний угол табличного блока > Древовидная таблица.
    Вы заметите, что в момент выбора появляется переключатель "Развернуть все" под Древовидной таблицей.
    В то же время, ранее созданная "Глава первая" исчезает.
2.  Нажмите на опцию "Развернуть все" под Древовидной таблицей, чтобы активировать ее.
    Теперь мы можем видеть, что родительско-дочерняя структура документа отображается более интуитивно, позволяя легко просматривать и разворачивать все уровни документов.
    Давайте продолжим с действием "Добавить подзапись".

Преобразование в древовидную таблицу завершено!

![](https://static-docs.nocobase.com/Solution/291734257429202415181012.png)

![](https://static-docs.nocobase.com/Solution/321734257492202415201112.png)

#### 8.3.3 Настройка «Добавить дочернюю запись»

Чтобы добавлять дочерние записи, мы настроим необходимые элементы. Когда поле Родительской записи выбрано, оно по умолчанию становится "только для чтения", так как новые записи создаются внутри текущего каталога документа.

![](https://static-docs.nocobase.com/Solution/351734262415202415193312.png)

Если данных задач слишком много, вам может быть особенно неудобно назначать связанные задачи. Мы можем установить значение по умолчанию для фильтрации задач, сделав его равным задачам, связанным с родительской записью.

![](https://static-docs.nocobase.com/Solution/171734262577202415193612.png)

![](https://static-docs.nocobase.com/Solution/211734262761202415193912.png)

Значение по умолчанию может вступить в силу не сразу, давайте закроем и снова нажмем, чтобы увидеть, что оно было автоматически заполнено~!

### 8.4 Настройка шаблонов форм и связей задач

#### 8.4.1 Создание [Шаблонов](https://docs.nocobase.com/handbook/block-template) таблиц и форм

Чтобы облегчить управление в будущем, сохраните Таблицу документов вместе с ее формами создания/редактирования как [шаблоны](https://docs.nocobase.com/handbook/block-template) для повторного использования на других страницах.

![](https://static-docs.nocobase.com/Solution/571734263097202415194412.png)

#### 8.4.2 Отображение скопированной таблицы документов

Во всплывающем окне просмотра Задачи [добавьте новую вкладку](https://docs-cn.nocobase.com/manual/ui/pages#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0-%D0%B2%D0%BA%D0%BB%D0%B0%D0%B4%D0%BE%D0%BA) с названием "Документы". Внутри этой вкладки добавьте блок формы > Другие записи > Документы > «Копировать шаблон» > и импортируйте ранее созданный шаблон таблицы документов. (Убедитесь, что вы выбрали [**Копировать шаблон**](https://docs.nocobase.com/handbook/block-template)).

![](https://static-docs.nocobase.com/Solution/111734263351202415194912.png)

Этот метод упрощает создание списка документов.

#### 8.4.3 Настройка связей с задачами

Поскольку мы скопировали внешний шаблон таблицы, он еще не связан с Коллекцией задач. Вы можете заметить, что он отображает все данные документов, что не идеально.

Такая ситуация довольно распространена. Если мы не создали соответствующее поле связи, но все равно хотим отображать связанные данные, мы должны вручную связать эти два элемента. (**Примечание:** Мы используем [копию шаблона](https://docs.nocobase.com/handbook/block-template), а не [ссылку на шаблон](https://docs.nocobase.com/handbook/block-template); иначе все наши изменения будут синхронизироваться с другими табличными блоками!)

- Связь отображения данных

Нажимаем на правый верхний угол табличного блока и [«Устанавливаем область данных»](https://docs.nocobase.com/handbook/ui/blocks/block-settings/data-scope) на:

【Задача/ID】= 【Текущая всплывающая запись/ID】

![](https://static-docs.nocobase.com/Solution/581734263458202415195012.png)

![](https://static-docs.nocobase.com/Solution/291734263669202415195412.png)

Успешно, документы, оставшиеся в таблице, — это те, которые связаны с нашей задачей.

- Связь блока формы добавления.

Войдите в экран добавления блока:

Для полей, связанных с задачами, установите [значение по умолчанию](https://docs.nocobase.com/handbook/ui/fields/field-settings/default-value) > [Родительская всплывающая запись].

Родительское всплывающее окно является частью операции «Просмотр» для текущих данных задачи и будет напрямую ссылаться на соответствующие данные задачи.

Установка его в режим [только для чтения (режим просмотра)](https://docs.nocobase.com/handbook/ui/fields/field-settings/pattern) указывает, что внутри этого всплывающего окна можно связать только текущую задачу.

![](https://static-docs.nocobase.com/Solution/051734264005202415200012.png)

![](https://static-docs.nocobase.com/Solution/571734264117202415200112.png)

Готово! Теперь все новые добавляемые и отображаемые элементы будут связаны с документом текущей задачи.

Если вы внимательны, вы можете добавить фильтр связи в «Редактирование» и «Добавить подзадачу».

Чтобы сделать древовидную структуру более четкой, а столбец Действий — более аккуратным, давайте переместим заголовок в первый столбец.

![](https://static-docs.nocobase.com/Solution/451734264225202415200312.png)

### 8.5 Фильтрация и поиск в управлении документами

##### 8.5.1 Добавление [Блока фильтров](https://docs.nocobase.com/handbook/ui/blocks/filter-blocks/form)

Добавьте блок фильтров в Документы, чтобы включить расширенные параметры поиска.

-   Добавьте блок фильтров на страницу Управления документами.
-   Выберите форму для фильтрации и перетащите ее наверх.
-   Отметьте такие поля, как Заголовок, Статус и Задача, в качестве критериев фильтрации.
-   Добавьте действия «Фильтр» и «Сбросить».

Эта форма фильтра действует как поисковая строка, позволяя быстро находить документы по введенным ключевым словам.

![](https://static-docs.nocobase.com/Solution/571734264297202415200412.png)

![](https://static-docs.nocobase.com/Solution/111734264491202415200812.png)

#### 8.5.2 [Связывание блоков данных](https://docs.nocobase.com/handbook/ui/blocks/block-settings/connect-block)

В этот момент вы можете заметить, что нажатие не дает результата. Нам нужен последний шаг: связывание блоков с функцией поиска друг с другом.

-   Нажмите **Настройки** в правом верхнем углу блока и выберите [**Связывание блоков данных**](https://docs.nocobase.com/handbook/ui/blocks/block-settings/connect-block).

    ```
    Здесь вы увидите список доступных блоков, которые можно связать.

    Поскольку мы создали форму документа, она будет искать все блоки данных, связанные с таблицей документов (на этой странице он только один), и отображать их в качестве вариантов.

    Не нужно беспокоиться о том, что запутаетесь, так как наведение курсора на опцию автоматически выделит экран соответствующего блока.
    ```

-   Нажмите, чтобы включить блок, который вы хотите связать, и протестируйте поиск.

![](https://static-docs.nocobase.com/Solution/demoE3v1-48.gif)

Нажмите кнопку настройки в правом верхнем углу блока фильтров, чтобы связать его с главным блоком данных таблицы документов. Таким образом, всякий раз, когда вы устанавливаете условие в блоке фильтров, табличный блок автоматически обновляет результаты на основе этого условия.

### 8.6 [Настройка прав доступа](https://docs.nocobase.com/handbook/acl) для базы знаний

Для защиты документов и стандартизации управления назначайте права доступа на основе ролей пользователей, позволяя разным пользователям просматривать, редактировать или удалять документы в соответствии с их [правами](https://docs.nocobase.com/handbook/acl).

Однако мы будем улучшать базу документов, добавляя функции для новостей и объявлений о задачах, что позволит использовать более гибкие разрешения.

### 8.7 Резюме и следующие шаги

В этой главе мы заложили основу базы знаний, включив в нее Коллекцию документов, [Древовидную коллекцию](https://docs.nocobase.com/handbook/collection-tree) и связи с задачами. Добавив блоки фильтров и многоразовые шаблоны, мы оптимизировали управление документами для повышения эффективности.

[Далее](https://www.nocobase.com/en/tutorials/project-tutorial-task-dashboard-part-1) мы создадим личную панель управления с [графиками](https://docs.nocobase.com/handbook/data-visualization) для анализа данных и отображения ключевой информации!

---

Продолжайте исследовать и погружаться в бесконечные возможности! Если у вас возникнут какие-либо проблемы на пути, не забывайте проверять [Документацию NocoBase](https://docs.nocobase.com/) или присоединяйтесь к [Сообществу NocoBase](https://forum.nocobase.com/) для обсуждений и поддержки.
