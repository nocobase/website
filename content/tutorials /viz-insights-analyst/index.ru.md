# Основное позиционирование Viz

Аналитик данных + Бизнес-консультант. Превращаю обсуждения в запросы, быстро извлекаю ключевые данные и создаю графики с краткими выводами.

## Ключевые возможности

- **Автоматическое построение графиков и аналитика:** Визуализация данных в один клик для быстрого выявления трендов, аномалий и ключевых точек изменения.
- **Бизнес-ориентированная интерпретация:** Анализ данных по регионам, каналам, аудитории и продуктам для атрибуции, сравнения и сегментации.
- **Поддержка решений множеством методов:** Применяйте анализ воронки, анализ удержания, пожизненную ценность клиента (LTV) и анализ вклада для определения бизнес-приоритетов.
- **Практические рекомендации на основе данных:** Представляйте только фактические, реализуемые стратегии роста и улучшений без фальсификации данных.

## Типичные сценарии

| Сценарий                                                                 | Ключевой вопрос                                                                      | Результат                                                                                                                | Промпт                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Ежемесячный бизнес-обзор и диагностика трендов**                       | Что улучшилось или ухудшилось по сравнению с прошлым месяцем?                        | KPI-карточки (выручка, заказы, средний чек), линейные графики трендов, таблица с ростом к прошедшему месяцу/году, 3 рекомендации | Сгенерируй «Ежемесячный бизнес-обзор».<br/>Временной диапазон: этот месяц vs прошлый месяц & тот же месяц прошлого года.<br/>Измерения: Общее + Канал (Прямой/Партнерский) + Регион.<br/>Результат: KPI-карточки, график тренда, таблица с ростом, 3 рекомендации на основе данных.                  |
| **Декомпозиция роста: Объем vs Цена**                                    | Рост выручки обусловлен большим числом заказов или более высокой стоимостью заказа? | Декомпозиция Выручки = Трафик × Конверсия × Средний чек; Столбчатая диаграмма вклада                                      | Разбей изменение выручки за последние 90 дней на составляющие: трафик, конверсия и средний чек.<br/>Результат: диаграмма декомпозиции + 3 таблицы сравнения + вклад каждого фактора.                                                                                                                                              |
| **Продуктовая матрица: Драйверы vs Балласт прибыли**                     | Какие продукты приносят больше всего прибыли? Какие связывают запасы с низкой маржой? | Списки: Топ-10/Аутсайдеры; диаграмма 80/20 вклада в прибыль; рекомендации по распродаже                                   | Покажи вклад в прибыль по категориям/продуктам.<br/>Результат: Списки Топ-10/Аутсайдеры, диаграмма 80/20, рекомендации по распродаже.<br/>Выдели товары с высоким объемом и низкой маржой как рисковые.                                                                                                                          |
| **Здоровье каналов: ROI & Качество привлечения**                         | Какой канал стоит масштабировать, а какой сократить?                                 | Сравнение ROI по каналам, соотношение первых/повторных покупок, удержание за 7/30 дней, CAC & LTV                        | Проанализируй ROI, соотношение первых/повторных покупок, удержание за 7/30 дней, CAC и LTV для каждого канала за последние 60 дней.<br/>Результат: таблица сравнения каналов + диаграмма вклада + предложения «Масштабировать/Держать/Сократить».                                                                                |
| **Воронка и узкие места конверсии**                                      | Трафика много, а продаж мало — где отток?                                            | Воронка: Показ→Клик→Корзина→Заказ→Оплата; ключевые узкие места и действия                                             | Построй маркетинговую воронку (Показ→Клик→Корзина→Заказ→Оплата), чтобы найти стадию с наибольшим оттоком.<br/>Предложи 3 рекомендации по оптимизации на основе данных (направление, загрузка страницы, тексты, триггеры акций).                                                                                                       |**Сегментация и удержание: портрет ценных клиентов**  |  Какие признаки делают клиента ценным и как повысить долю повторных покупок?  |  RFM‑сегментация и когортный анализ кривой удержания; выделение ядра аудитории; практические рекомендации по работе с сегментами  |  Проведи RFM‑сегментацию и построй когортные кривые удержания; опиши профиль высокоценной аудитории и предложи меры по вовлечению и возврату                                                                                                                                                                                     |
| **Оценка эффекта промоакций и цен**                                           | Дала ли акция реальный прирост прибыли? Какова чувствительность клиентов к цене?   | Сравнение показателей до и после акции, анализ ценовой эластичности, расчет влияния на прибыль                                    | Оцени влияние крупной акции на прошлой неделе на GMV, валовую маржу и уровень повторных покупок; оцени диапазон ценовой эластичности.<br/>Результат: сравнение метрик + краткий вывод + предупреждение о рисках.                                                                                                                   |
| **Прогнозирование спроса и рекомендации по запасам**               | Сколько заказов в следующем месяце и какой запас безопасен?                          | Упрощенный прогноз на основе сезонности/тренда; диапазон пополнения и список SKU с риском дефицита                       | Используй продажи за последние 12 месяцев для прогноза спроса на следующий месяц и SKU с риском дефицита.<br/>Результат: график прогноза + список SKU + рекомендуемый диапазон пополнения с пояснением допущений.                                                                                                                |
| **Предложения по Ключевой метрике (North Star Metric)**                   | На каком KPI команде стоит сфокусироваться?                                          | Список кандидатов в KPI (измеримые, действенные, связанные с долгосрочной ценностью) с обоснованием на данных            | Предложи 3 кандидата на роль ключевой метрики «North Star Metric» и объясни логику выбора и доступность данных.<br/>Результат: таблица кандидатов + обоснование рекомендации.                                                                                                                              |

## 1) Общий раздел: Определение фона Viz

### Основной фон Viz

```yaml
# Определение основного образа
Ты — **Viz**, проницательный, визуально-ориентированный **AI-аналитик данных** и рассказчик. Ты превращаешь сырые данные в убедительные визуальные нарративы. Дружелюбный и доступный, твоя цель — сделать сложные данные мгновенно понятными и действенными через увлекательную визуализацию.

**Основная миссия:**
Твоя миссия — запрашивать необходимые источники данных, анализировать результаты и представлять выводы в четких, визуально привлекательных форматах (таких как графики и KPI-карточки) с краткими пояснениями.

**Твой процесс работы:**
1.  **Понять намерение пользователя:** Проанализируй вопрос пользователя, чтобы определить его аналитическую цель и необходимые данные.
2.  **Формулировать и выполнять запросы:** Генерируй безопасные, read-only SQL SELECT запросы или используй указанные инструменты для получения данных. Всегда жди получения данных, прежде чем продолжить.
3.  **Анализировать и объяснять:** Проанализируй полученные данные и прямо ответь на вопрос. Никогда не фальсифицируй выводы. Держи текстовые объяснения краткими и сфокусированными на интерпретации визуализации.
4.  **Визуализировать и представлять:** Визуализация — твоя сильная сторона:
    *   Для трендов, сравнений или распределений: создавай графики (столбчатые, линейные, круговые и т.д.) в валидном JSON для ECharts.
    *   Для ключевых отдельных метрик: представляй их в виде визуально эффектных KPI-карточек.
    *   Даже для простых чисел, представляй их визуально увлекательным способом.

**Ключевые правила:**
*   **Язык:** Отдавай приоритет языку пользователя ({{$nLang}}) и отвечай на языке вопроса для ясности. Если неясно или не поддерживается, используй английский по умолчанию.
*   **Приоритет визуализации:** Только если визуализация действительно невозможна, создавай графики или KPI-карточки.
*   **Целостность данных:** Никогда не фальсифицируй данные и не делай выводы без доказательств.
*   **Безопасность SQL:** Генерируй только SELECT запросы; никогда не используй INSERT, UPDATE или DELETE.
*   **Формат ECharts:** При создании графиков используй только теги `<echarts>` с чистым, валидным JSON; без комментариев, JS-функций или исполняемого кода.

**Правила формата визуализации:**
*   Используй `<echarts>{...JSON...}</echarts>` напрямую; не оборачивай в блоки кода.
*   Убедись, что JSON валиден и правильно отформатирован.
*   Включай соответствующие всплывающие подсказки, легенды и метки для ясности.
*   Выбирай тип графика, наиболее подходящий для данных (круговой для долей, столбчатый для сравнений, линейный для трендов и т.д.)

**Пример формата вывода:**

[Кратко опиши выводы на {{nLang}}]

<echarts>
{
  "tooltip": { "trigger": "item" },
  "legend": { "top": "5%", "left": "center" },
  "series": [
    {
      "name": "Data Series",
      "type": "pie",
      "radius": ["40%", "70%"],
      "data": [
        { "value": 1048, "name": "Category A" },
        { "value": 735, "name": "Category B" }
      ]
    }
  ]
}
</echarts>

**Неправильный пример (Избегай):**
// Неверно
JavaScript функции: Не используй функции в форматтерах или других свойствах. Это исполняемый код, а не валидный JSON.
<echarts>
...
"tooltip": {
"formatter": function (params) {
return params.name + ': ' + params.value;
}
}
...
</echarts>
```

Это определение фона является **общим**, применимым к любому сценарию анализа данных.

## 2) Специализация: Задача бизнес-анализа CRM

### От общих к специализированным потребностям

При использовании **Viz** для общего анализа данных задачи, связанных с CRM (лиды, сделки, клиенты), нам приходилось каждый раз:

* Писать сложные SQL-запросы с описанием нескольких таблиц.
* Пересчитывать воронки конверсии.
* Вручную организовывать этапы сделок.

### Создание специализированной задачи: Комплексный анализ данных CRM

#### Пример промпта для задачи

```yaml
Привет Viz,

Мне нужна твоя помощь в проведении комплексного визуального анализа текущих данных.

**Основная задача:**
Сначала попробуй использовать инструмент **`Overall Analytics`**, чтобы получить обзор данных о **лидах, клиентах, контактах и сделках**.

**Ключевые инструкции:**
0.  **Важное условие: Подтверждение имен таблиц**
    *   Перед использованием любого инструмента сначала **подтверди точные имена таблиц** в базе данных.
    *   Мои инструкции могут использовать общие термины, такие как "лиды", но в базе данных могут требоваться точные имена, например, "lead".

1.  **Получение данных:**
    *   После подтверждения имен таблиц используй инструмент `Overall Analytics`.
    *   Если в инструменте не хватает необходимых данных, переключись на SQL.

2.  **Требования к визуализации:**
    *   Создавай **отдельные и четкие графики** для каждого ключевого наблюдения.
    *   Все графики должны быть в формате ECharts.
    *   Предоставляй краткое пояснение под каждым графиком.

Пожалуйста, начни с анализа данных по Сделкам (Лидам).

```

#### Ожидаемый результат

![01_Viz_DataAnalyst_cn-2025-09-29-12-52-05](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-12-52-05.jpg)

![01_Viz_DataAnalyst_cn-2025-09-29-12-52-18](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-12-52-18.jpg)

### Вспомогательный инструмент: Overall Analytics

Чтобы сделать эту задачу анализа CRM более эффективной, мы создали специализированный инструмент:

**1. Таблица data\_analysis**

| Отображаемое имя поля | Имя поля     | Тип поля            |
| --------------------- | ------------ | ------------------- |
| **PK & FK поля**      |              |                     |
| ID                    | id           | Целое (Integer)             |
| **Общие поля**        |              |                     |
| Название              | name         |  Текстовая строка  |
| SQL                   | sql          | Code (SQL)          |
| Коллекция             | collection   | Селектор коллекций |
| Описание              | description  | Markdown(Vditor)    |
| **Системные поля**    |              |                     |
| Создано               | createdAt    | Когда создано           |
| Кем создано           | createdBy    | Создатель          |
| Последнее обновление  | updatedAt    | Когда изменено     |
| Кем обновлено         | updatedBy    | Редактор     |

![tasks-2025-09-29-12-47-18](https://static-docs.nocobase.com/tasks-2025-09-29-12-47-18.png)

![01_Viz_DataAnalyst_cn-2025-09-29-12-48-14](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-12-48-14.png)

**2. Рабочий процесс Overall Analytics**

* Специализированный инструмент для **Viz**.
* Используется только в задачах анализа CRM.
* Не изменяет основное определение **Viz**.
  ![01_Viz_DataAnalyst_cn-2025-09-29-12-56-40](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-12-56-40.png)

**3. Преимущества**

* Повышена эффективность анализа CRM, не нужно писать SQL вручную.
* Стандартизирован формат вывода.
* Бизнес-персонал может быстро его использовать.

## 3) Лучшие практики: Проектирование и использование Viz

### Шаг 1: Понимание взаимосвязи между фоном и задачей

![](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-18-56-13.jpg)

### Шаг 2: Написание эффективных промптов для задач

#### Советы по написанию промптов

Ниже приведена проверенная и эффективная структура промпта:

![](https://static-docs.nocobase.com/01_Viz_DataAnalyst_cn-2025-09-29-18-56-30.jpg)

#### Почему это работает

1.  **Четкая роль** – "Привет Viz" сразу задает AI роль аналитика данных.
2.  **Структурированные инструкции** – **Жирный** текст и нумерованные шаги делают инструкции легкими для выполнения.
3.  **Предварительные условия** – Пункт 0 выделяет решающие предостережения (например, проверка имен таблиц).
4.  **Приоритет инструментов** – Четко указано, какой инструмент использовать первым и запасные варианты.
5.  **Конкретные требования** – «Сгенерируй отдельные графики» более точно, чем «сгенерируй графики».

### Шаг 3: Примеры практического применения

#### Сценарий: Ежемесячный бизнес-анализ

**Исходный запрос:** Босс хочет обзор результатов работы в этом месяце.

**Оптимизированный промпт:**

```markdown
Привет Viz,

Пожалуйста, сгенерируй отчет по бизнес-анализу за этот месяц.

**Требования к анализу:**
0. **Проверка данных**
   * Убедись, что таблица заказов содержит данные за последний месяц.
   * Если данных нет, четко укажи это.

1. **Ключевые метрики (показать KPI-карточки)**
   * Общая выручка
   * Количество заказов
   * Средний чек
   * Темпы роста по сравнению с прошлым месяцем

2. **Анализ трендов (отдельный график)**
   * Линейный график ежедневных продаж
   * Отметь наивысшие и низшие точки
   * Покажи кривую среднего значения за 7 дней

3. **Формат вывода**
   * Каждый пункт анализа на отдельном графике
   * Пояснение из 2–3 предложений под каждым графиком
   * Заверши 3 рекомендациями на основе данных

Временной диапазон: С 1-го числа этого месяца по сегодняшний день
Источник данных: таблицы orders и order_items

```

#### Сценарий: Диагностика падения продаж

**Исходный запрос:** Продажи падают — выясни причину.

**Оптимизированный промпт:**

```markdown
Привет Viz,

Помоги диагностировать недавнее падение продаж.

**Шаги диагностики:**
0. **Подтверждение проблемы**
   * Сравни продажи этой недели с прошлой неделей
   * Рассчитай процентное снижение

1. **Разбиение по множеству измерений**
   * По продуктовым категориям: какая категория упала больше всего
   * По каналам: какой канал работает хуже
   * По регионам: есть ли специфическое падение в регионе
   * По клиентам: изменения среди новых vs постоянных клиентов

2. **Глубокий анализ**
   * Определи измерение с самым резким падением
   * Проанализируй конкретные проблемы в этом измерении
   * Проверь на наличие аномальных заказов или возвратов

3. **Требования к выводу**
   * Используй waterfall-график, чтобы показать вклад каждого фактора
   * Предоставь таблицу сравнения с детальными данными
   * Представь 3 наиболее вероятные причины и методы их проверки

Сначала используй Overall Analytics для получения общих данных. Если нужны детали, дополни SQL.

```

## 4) Оптимизация промптов и обработка проблем

### Советы по оптимизации промптов

| Тип приема              | Плохой пример          | Лучший пример                                                             | Причина                           |
| ----------------------- | ---------------------- | ------------------------------------------------------------------------- | --------------------------------- |
| **Проверка имени таблицы** | Проанализируй данные по лидам | Проанализируй данные по Лидам (сначала убедись, что имя таблицы "leads" или "lead") | Избегает ошибок в именах таблиц   |
| **Контроль вывода**     | Сгенерируй графики     | Сгенерируй отдельные графики ECharts для каждой метрики                   | Гарантирует формат вывода         |
| **Спецификация инструмента** | Запроси и проанализируй данные | 1. Предпочтительно используй Overall Analytics 2. Используй SQL при необходимости | Четкий приоритет инструментов     |
| **Обработка ошибок**    | Без упоминания об обработке ошибок         | Если данных нет, четко укажи, чего именно не хватает                      | Предотвращает выдумывание данных AI |

### Решение распространенных проблем

| Проблема             | Причина                                        | Решение                                                |
| -------------------- | ---------------------------------------------- | ------------------------------------------------------ |
| Слишком сложные графики | Нет требования к отдельным графикам          | Явно запрашивай «отдельные графики для каждой метрики» |
| Ошибки в именах таблиц | Пользователь использует множественное число, а в БД указано единственное | Добавляй условие «подтверди имя таблицы»             |
| Фальсификация данных | Нет акцента на достоверности данных            | Добавляй правило «никогда не фальсифицируй данные»   |
| Слишком длинный вывод | Нет ограничения на длину пояснения             | Запрашивай «краткое пояснение из 2–3 предложений»    |
| Ошибки формата       | Не указан формат вывода                        | Уточняй  «используй теги `<echarts>`»                |

## Резюме

### Ключевые выводы

1.  **Двухуровневая архитектура**
    *   Определение фона: стабильная общая способность.
    *   Специализация задач: гибкие бизнес-инструменты.
2.  **Расширение возможностей инструментами**
    *   Инструменты являются частью задач, а не частью основной личности ИИ-сотрудника.
    *   Создавайте специализированные инструменты по мере развития бизнес-потребностей.
3.  **Искусство составления промптов**
    *   Структурированные, конкретные, ориентированные на инструменты.
    *   Сначала проверь, затем выполняй, приводи примеры.
4.  **Непрерывная оптимизация**
    *   Переход от общих решений к специализированным — это естественная эволюция.
    *   Наиболее эффективные улучшения достигаются тогда, когда они продиктованы реальными проблемами бизнеса.