Многие пользователи замечают, что после развертывания NocoBase работает медленнее, чем ожидалось. Обычно это связано с сетевыми условиями, настройками сервера или архитектурой развертывания. Прежде чем переходить к оптимизации, ознакомьтесь с эталонными показателями нормальной скорости загрузки NocoBase, чтобы избежать лишних опасений.

### Эталонные значения скорости загрузки NocoBase

Ниже приведены значения времени загрузки, полученные в демо-окружении NocoBase:

* Время входа в приложение при первом переходе по ссылке: примерно 2 секунды
* Время переключения между страницами в приложении: примерно 50-300 миллисекунд

<video autoplay loop width="100%">
      <source src="https://static-docs.nocobase.com/886b8e6afd4eea8fd1ff601fdbaecaf0.mp4">
</video>

<video autoplay loop width="100%">
      <source src="https://static-docs.nocobase.com/c240cf4029820f0e4c2bbb58723e2d76.mp4">
</video>

Далее я поделюсь рядом простых, но эффективных методов оптимизации развертывания, которые могут значительно улучшить скорость доступа за счёт корректировки настроек развертывания, без необходимости изменять код:

## I. Оптимизация сети и инфраструктуры

### 1. Версия HTTP-протокола: Рекомендуется использовать HTTP/2

【Системные требования】

- **Требуется поддержка HTTPS**: Это важно! Почти все современные браузеры поддерживают HTTP/2 только через HTTPS-соединения, поэтому сначала необходимо настроить SSL-сертификаты.
- **Требования к серверу**: Необходимо использовать серверное программное обеспечение с поддержкой HTTP/2, такое как Nginx 1.9.5+ или Apache 2.4.17+.
- **Версия TLS**: Рекомендуется TLS 1.2 или выше (лучше всего TLS 1.3), поскольку старые версии SSL не поддерживают HTTP/2.

【Советы】

Традиционный протокол HTTP/1.1 имеет ограничения при обработке множественных запросов — обычно одновременно обрабатывается только 6-8 соединений, что похоже на очередь за билетами и легко вызывает задержки.
![250416_http1_en](https://static-docs.nocobase.com/250416_http1_en.png)

HTTP/2 использует технологию «мультиплексирования» для одновременной обработки множественных запросов, значительно ускоряя загрузку ресурсов; в то время как новейший HTTP/3 показывает ещё лучшую производительность в нестабильных сетях с превосходными результатами.
![250416_http2_en](https://static-docs.nocobase.com/250416_http2_en.png)

【Рекомендации по оптимизации】

- Убедитесь, что ваш веб-сервер имеет включенную поддержку HTTP/2, что легко настроить на большинстве серверов (таких как Nginx, Caddy).
- В Nginx просто добавьте параметр `http2` после директивы listen:
```nginx
listen 443 ssl http2;
```

【Проверка】

В панели разработчика вашего браузера откройте опцию «Network», щелкните правой кнопкой мыши и проверьте «Protocol», чтобы увидеть версию протокола текущего соединения:
![20250407145442](https://static-docs.nocobase.com/20250407145442.png)

По нашим тестам, общая скорость увеличивается примерно на 10%, с более значительным улучшением производительности, если в системе много блоков и ресурсов.

### 2. Пропускная способность сети: Чем больше, тем лучше, гибкая тарификация

【Советы】

Так же как скоростные трассы свободнее местных дорог, пропускная способность определяет эффективность передачи данных. При первой загрузке NocoBase необходимо загрузить множество клиентских ресурсов, и недостаточная пропускная способность легко может стать узким местом.

【Рекомендации по оптимизации】

- Выбирайте достаточную пропускную способность (рекомендуется 50 Мбит/с+ для многих пользователей), не экономьте на этом критическом ресурсе.
- Рекомендуем тарификацию «по факту использования»: многие облачные провайдеры предлагают эту гибкую модель, позволяя вам использовать более высокую пропускную способность в пиковые периоды, контролируя затраты в обычное время.

### 3. Сетевая задержка и географическое расположение сервера: Ближе — значит быстрее

【Советы】

Задержка — это время ожидания при передаче данных. Даже при достаточной пропускной способности, если сервер находится слишком далеко от пользователей (например, пользователи в Китае, а сервер в США), каждый ответ на запрос может замедляться из-за большого расстояния.

【Рекомендации по оптимизации】

- Старайтесь развертывать NocoBase в регионах, ближе к вашей основной пользовательской базе.
- Если ваши пользователи распределены по всему миру, рассмотрите возможность использования услуг глобального ускорения (таких как Alibaba Cloud Global Accelerator или AWS Global Accelerator) для оптимизации сетевых маршрутов и снижения задержек.

【Проверка】

Используйте команду ping для проверки задержек из разных регионов.
Этот подход показывает наиболее очевидное улучшение: скорость доступа увеличивается в 1-3 раза или более в зависимости от региона.
Через 12 часовых поясов, 13 секунд:
![20250416130618](https://static-docs.nocobase.com/20250416130618.png)

Через 2 часовых пояса, 8 секунд:
![20250409131039](https://static-docs.nocobase.com/20250409131039.png)

Текущий регион, около 3 секунд:
![20250409130928](https://static-docs.nocobase.com/20250409130928.png)

## II. Оптимизация архитектуры развертывания

### 4. Развертывание сервера и методы прокси: Выбираем наиболее подходящую архитектуру

【Системные требования】

- Права на сервере: Вам нужен root-доступ или права sudo для настройки таких служб, как Nginx.
- Базовые навыки: Требуются некоторые базовые знания по настройке сервера, но не волнуйтесь, будут предоставлены конкретные примеры конфигурации.
- Доступ к портам: Убедитесь, что ваш брандмауэр разрешает доступ к портам 80 (HTTP) и 443 (HTTPS).

【Советы】

Когда пользователи обращаются к NocoBase, запросы поступают напрямую на ваш сервер. Подходящий метод развертывания позволяет вашему серверу более эффективно обрабатывать запросы и обеспечивать более быстрые ответы.

【Различные решения и рекомендации】

**Запуск NocoBase без использования обратного прокси для статических ресурсов (не рекомендуется):**

- Недостатки: Этот метод прост, но плохо справляется с высокой нагрузкой или статическими файлами; подходит только для разработки и тестирования.
- Рекомендация: по возможности избегайте этого метода.

> См. "[Документация по установке](https://docs.nocobase.com/welcome/getting-started/installation)"

Без обратного прокси загрузка главной страницы занимает около 6,1 секунды
![20250409131357](https://static-docs.nocobase.com/20250409131357.png)

**Использование Nginx / Caddy в качестве обратного прокси (настоятельно рекомендуется):**

- Преимущества: Серверы обратного прокси могут эффективно обрабатывать параллельные соединения, обслуживать статические файлы, реализовывать балансировку нагрузки и упрощают настройку HTTP/2.
- Рекомендация: В производственных средах, после развертывания приложения (развертывание исходного кода / create-nocobase-app / Docker-образ), используйте Nginx или Caddy в качестве обратного прокси.

> См. "[Документация по развертыванию](https://docs.nocobase.com/welcome/getting-started/deployment)"

С прокси Nginx загрузка главной страницы занимает около 3-4 секунд
![20250409131541](https://static-docs.nocobase.com/20250409131541.png)

![20250416081410](https://static-docs.nocobase.com/20250416081410.png)

**Использование кластерного развертывания с балансировкой нагрузки (подходит для сценариев с высокой нагрузкой и высокой доступностью):**

- Преимущества: Развернув несколько экземпляров для обработки запросов, вы можете значительно повысить общую стабильность системы и пропускную способность.
- Конкретные методы развертывания см. в **[Режиме кластера](https://docs.nocobase.com/welcome/getting-started/deployment/cluster-mode)**

### 5. Использование CDN для ускорения статических ресурсов

【Системные требования】

- **Требования к домену**: Вам необходимо зарегистрированное доменное имя и возможность управлять его DNS-настройками.
- **SSL-сертификат**: Большинству CDN-сервисов требуется настройка SSL-сертификата (можно использовать бесплатные сертификаты Let's Encrypt).
- **Выбор сервиса**: Выбирайте подходящих CDN-провайдеров в зависимости от регионов пользователей (пользователям в материковом Китае требуются CDN с ICP-регистрацией).

【Советы】
CDN (Content Delivery Network) кэширует ваши статические ресурсы на узлах по всему миру, позволяя пользователям получать ресурсы с ближайшего узла, подобно тому, как брать воду из ближайшего источника, что значительно сокращает задержки загрузки.

Кроме того, наибольшее преимущество CDN — их способность значительно снижать нагрузку и давление на пропускную способность вашего сервера приложений. Когда множество пользователей одновременно обращаются к NocoBase без CDN, все запросы статических ресурсов (JavaScript, CSS, изображения и т.д.) поступают напрямую на ваш сервер, что может привести к насыщению пропускной способности, снижению производительности или даже падению сервера. Переложив эти запросы на CDN, ваш сервер может сосредоточиться на обработке основной бизнес-логики, обеспечивая пользователям более стабильный опыт.

![20250416_0826](https://static-docs.nocobase.com/20250416_0826.png)

【Рекомендации по оптимизации】• Настройте ваш сервер для распределения запросов статических ресурсов через CDN.• Выбирайте подходящих CDN-провайдеров в зависимости от местоположения пользователей:

- Глобальные пользователи: Cloudflare, Akamai, AWS CloudFront;
- Пользователи в материковом Китае: Alibaba Cloud CDN, Tencent Cloud CDN, Baidu Cloud Acceleration. Пример конфигурации:

```nginx
# Перенаправление статических ресурсов на CDN-домен
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    rewrite ^(.*)$ https://your-cdn-domain.com$1 permanent;
}
```

- Для небольших проектов бесплатный тариф Cloudflare может обеспечить хорошее ускорение через CDN:

1. Зарегистрируйте аккаунт Cloudflare и добавьте ваш домен;
2. Измените DNS, направив ваш домен на серверы Cloudflare;
3. Установите подходящие уровни кэширования в панели управления.

**Особое примечание**: Даже если все ваши пользователи находятся в одном регионе, всё равно настоятельно рекомендуется использовать CDN, так как это эффективно снижает нагрузку на сервер, повышает общую стабильность системы, особенно в периоды высокой посещаемости.

## III. Оптимизация статических ресурсов

### 6. Сжатие и настройка кэширования на сервере

【Системные требования】

- **Ресурсы ЦП**: Сжатие увеличивает нагрузку на ЦП сервера, поэтому ваш сервер должен иметь достаточную вычислительную мощность.
- **Поддержка модулей Nginx**: Сжатие Gzip обычно встроено, но для сжатия Brotli может потребоваться установка дополнительных модулей.
- **Права на конфигурацию**: Вам необходимо право изменять конфигурации сервера.

【Советы】

Включив сжатие и реализовав разумные стратегии кэширования, вы можете значительно уменьшить объем передаваемых данных и повторяющихся запросов, по сути «похудев» ваши ресурсы, чтобы скорость загрузки взлетела.
![20250416081719](https://static-docs.nocobase.com/20250416081719.png)

【Рекомендации по оптимизации】

- Самое простое решение: Используйте бесплатный CDN-сервис Cloudflare, который автоматически включает сжатие Gzip.
- Включите сжатие Gzip или Brotli, что можно настроить в Nginx следующим образом:

```nginx
# Включить сжатие Gzip
gzip on;
gzip_comp_level 6;
gzip_min_length 1000;
gzip_proxied any;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# Если поддерживается сжатие Brotli, включите его для более эффективного сжатия
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
```

- Установите соответствующие заголовки кэширования для статических ресурсов, чтобы уменьшить повторную загрузку:

```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 30d;
    add_header Cache-Control "public, max-age=2592000";
    access_log off;
}
```

### 7. Использование SSL/TLS и оптимизация производительности

【Системные требования】

- **SSL-сертификат**: Вам необходим действительный SSL-сертификат (можно использовать бесплатные сертификаты Let's Encrypt).
- **Права на настройку сервера**: Вам должна быть доступна возможность изменять SSL-конфигурации.
- **DNS-конфигурация**: Настройте надежные DNS-резолверы для OCSP Stapling.

【Советы】

Безопасность всегда на первом месте, но неправильная конфигурация HTTPS может добавить некоторую задержку. Вот несколько советов по оптимизации, которые помогут вам поддерживать высокую производительность, обеспечивая при этом безопасность.

【Рекомендации по оптимизации】

- Используйте TLS 1.3, который на данный момент является самой быстрой версией TLS. Настройте в Nginx:

```nginx
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers on;
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;
```

- Включите OCSP Stapling для сокращения времени проверки сертификата:

```nginx
ssl_stapling on;
ssl_stapling_verify on;
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;
```

- Сократите время повторного рукопожатия за счет повторного использования сессии:

```nginx
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
```

【Эффект межрегиональной оптимизации】
**Особое примечание**: Ниже показаны эффекты оптимизации в сценарии межрегионального доступа / через 12 часовых поясов, что фундаментально отличается от сценария локального доступа (около 3 секунд), упомянутого ранее. Сетевая задержка, вызванная географическим расстоянием, неизбежна, но оптимизация все же может значительно повысить скорость:

Комбинация Http2 + кэширование CDN + сжатие Gzip + сжатие Brotli:
До оптимизации (межрегиональный доступ), 13 секунд:
![20250416130618](https://static-docs.nocobase.com/20250416130618.png)
После оптимизации (межрегиональный доступ), 8 секунд:
![20250409173528](https://static-docs.nocobase.com/20250409173528.png)

Этот пример показывает, что даже при большом географическом расстоянии соответствующие меры оптимизации все же могут сократить время загрузки примерно на 40%, значительно улучшая пользовательский опыт.

## IV. Мониторинг и диагностика проблем

### 8. Мониторинг производительности и базовый анализ

【Системные требования】

- **Доступность**: Ваш сайт должен быть общедоступен для использования большинства онлайн-инструментов тестирования.
- **Базовые навыки**: Вам необходимо понимать базовое значение метрик производительности, хотя мы объясним каждый ключевой показатель.

【Советы】

Трудно точно оптимизировать, не зная, где находятся узкие места. Мы рекомендуем использовать некоторые бесплатные инструменты для мониторинга производительности сайта, чтобы помочь выявить проблемы.

【Рекомендации по оптимизации】

**Используйте следующие бесплатные инструменты для проверки производительности сайта:**

- [Google PageSpeed Insights](https://pagespeed.web.dev/)
- [WebPageTest](https://www.webpagetest.org/)
- [Pingdom](https://tools.pingdom.com/)

**Сосредоточьтесь на этих ключевых метриках:**

- Время загрузки страницы
- Время ответа сервера
- Время разрешения DNS
- Время SSL-рукопожатия

**Решения распространенных проблем:**

- Медленное разрешение DNS? Подумайте о смене DNS-сервиса или включении предварительного разрешения DNS.
- Медленный отклик SSL? Оптимизируйте конфигурацию SSL, включите повторное использование сессии.
- Медленный ответ сервера? Проверьте ресурсы сервера, при необходимости обновите.
- Медленная загрузка статических ресурсов? Попробуйте внедрить CDN и скорректировать стратегии кэширования.

## Контрольный список для быстрой оптимизации развертывания

Следующий контрольный список поможет вам быстро проверить и оптимизировать ваше развертывание NocoBase:

1. **Проверка версии HTTP**

   - [ ]  HTTPS включен (предварительное условие для HTTP/2)
   - [ ]  HTTP/2 включен
   - [ ]  Рассмотрите поддержку HTTP/3, если позволяют условия
2. **Оценка пропускной способности**

   - [ ]  Достаточная пропускная способность сервера (рекомендуется не менее 10 Мбит/с, предпочтительно 50 Мбит/с+)
   - [ ]  Рассмотрите модель тарификации по факту использования, а не фиксированную пропускную способность
3. **Выбор местоположения сервера**

   - [ ]  Местоположение сервера должно быть близко к регионам пользователей
   - [ ]  Рассмотрите использование услуг глобального ускорения для пользователей по всему миру
4. **Архитектура развертывания**

   - [ ]  Используйте Nginx/Caddy в качестве обратного прокси для разделения статических ресурсов и API
   - [ ]  При необходимости внедрите развертывание в несколько экземпляров и технологию балансировки нагрузки
5. **Внедрение CDN**

   - [ ]  Ускорьте распределение статических ресурсов через CDN
   - [ ]  Настройте соответствующие стратегии кэширования
   - [ ]  Убедитесь, что CDN поддерживает HTTP/2 или HTTP/3
6. **Сжатие и кэширование**

   - [ ]  Включите сжатие Gzip или Brotli
   - [ ]  Установите соответствующие заголовки кэширования браузера
7. **Оптимизация SSL/TLS**

   - [ ]  Используйте TLS 1.3 для ускорения отклика
   - [ ]  Включите OCSP Stapling
   - [ ]  Настройте повторное использование SSL-сессии
8. **Мониторинг производительности**

   - [ ]  Регулярно используйте инструменты тестирования производительности для оценки вашего сайта
   - [ ]  Отслеживайте ключевые метрики (время загрузки, ответа, разрешения)
   - [ ]  Оптимизируйте на основе выявленных проблем

## Часто задаваемые вопросы

【В】Мой сервер развернут в регионе, отличном от региона моих пользователей, что вызывает медленный доступ. Что делать?

【О】Лучшее решение — выбрать облачный сервер в том же регионе, что и ваши основные пользователи. Если это невозможно, вы также можете:

1. Использовать CDN-сервис для ускорения статических ресурсов;
2. Использовать услуги глобального ускорения для оптимизации сетевых маршрутов;
3. Включить все меры по сжатию и оптимизации кэширования по максимуму.

【В】Почему мой NocoBase медленно загружается при первом обращении, но потом быстро?

【О】Медленная первая загрузка — это нормально, потому что initially необходимо загрузить множество ресурсов.

На примере нашего официального Demo, первая загрузка обычно занимает около 3 секунд. Последующие ежедневные доступы при вводе URL занимают около 1-2 секунд, в то время как навигация между страницами внутри приложения очень быстрая — примерно 50-300 миллисекунд, с очень низкой задержкой.

![20250416130719](https://static-docs.nocobase.com/20250416130719.png)

Для чрезмерно длительного времени загрузки все еще есть возможности для оптимизации:

1. Убедитесь, что HTTP/2 включен;
2. Внедрите ускорение через CDN;
3. Включите сжатие Gzip/Brotli;
4. Проверьте, достаточна ли пропускная способность сервера.

【В】В настоящее время я использую виртуальный хостинг и не могу изменять конфигурацию Nginx. Что делать?

【О】В этом случае, хотя вариантов оптимизации меньше, мы все же рекомендуем:

1. Попробуйте использовать CDN-сервисы (например, Cloudflare);
2. Оптимизируйте параметры, которые можно настроить внутри приложения;
3. Если условия позволяют, рассмотрите возможность перехода на VPS, который поддерживает больше пользовательских настроек.

---

Благодаря этим простым, но практичным стратегиям оптимизации развертывания, вы можете значительно улучшить скорость доступа к NocoBase и обеспечить пользователям более плавный опыт. Многие меры оптимизации могут быть выполнены за несколько часов, не требуют изменений кода и легко дают результат.

Ежедневные операции:
![2504161639operatio_user2](https://static-docs.nocobase.com/2504161639operatio_user2.gif)
![2504161639operation3](https://static-docs.nocobase.com/2504161639operation3.gif)

