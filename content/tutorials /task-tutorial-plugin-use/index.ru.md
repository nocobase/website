## Обзор предыдущего раздела

Помните задание из предыдущего раздела? Мы настроили поля **Статус** и **Вложение** для нашей коллекции задач и отобразили их в списке задач. Давайте раскроем решение!

1. **Настройка поля Статус**:
   - Выберите поле [Выпадающий список](https://docs.nocobase.com/handbook/data-modeling/collection-fields/choices/select) и введите следующие варианты: **Не начата, В процессе, На проверке, Завершена, Отменена, В архиве**. Не стесняйтесь выбирать понравившиеся цвета, чтобы сделать задачи более яркими!

![Настройка поля Статус](https://static-docs.nocobase.com/Solution/511734183711202414214112.png)

2. **Настройка поля Вложение**:
   - Создайте новое поле [**Вложение**](https://docs-cn.nocobase.com/handbook/file-manager/field-attachment), дайте ему имя, например, "Вложение", и нажмите "Отправить". Это оказалось так просто!

![](https://static-docs.nocobase.com/Solution/251734183865202414214412.png)

3. **Отображение Создателя и Статуса в списке задач**:
   - В "настройке колонок" выберите поля «Создатель», «Статус» и «Вложение», чтобы показать более важную информацию в списке задач.

![Отображение полей в списке задач](https://static-docs.nocobase.com/Solution/201734183980202414214612.png)

4. **Отображение полей в формах добавления и редактирования**:
   - Не забудьте выбрать поля Статус и Вложение во всплывающей форме, чтобы вы могли легко видеть эти поля при добавлении или редактировании задачи.

![Отображение полей в формах](https://static-docs.nocobase.com/Solution/201734187340202414224212.png)

Отлично сработано! Продолжайте практиковать эти шаги, и вы станете более уверенными в использовании основных функций NocoBase. Каждый шаг закладывает прочный фундамент для будущего управления задачами. Давайте продолжим!

---

## 4.1 Содержание задачи и комментарии: Интерактивное управление задачами

На данный момент ваша система управления задачами может обрабатывать базовую информацию о задачах. Однако на практике для эффективной работы требуется больше, чем просто текстовые поля — часто нужны расширенные возможности и активное взаимодействие между участниками команды в реальном времени.

### 4.1.1 Markdown (Vditor): Сделать содержание задач более насыщенным

Вы могли заметить, что NocoBase предлагает как редакторы [**Форматированного текста**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/media/rich-text), так и [**Markdown**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/media/markdown), хотя они могут не полностью соответствовать вашим потребностям. В то время как редактор форматированного текста несколько ограничен, редактор Markdown прост в использовании, но не поддерживает предварительный просмотр в реальном времени.

![](https://static-docs.nocobase.com/Solution/311734187531202414224512.png)

Существует ли редактор, который поддерживает и предварительный просмотр в реальном времени, и обширные функции? Безусловно! [**Markdown (Vditor)**](https://docs.nocobase.com/handbook/field-markdown-vditor) — это самый мощный текстовый редактор в NocoBase, предлагающий предварительный просмотр в реальном времени, загрузку изображений и даже запись голоса. Плюс, он встроен в систему и полностью бесплатен!

> **Markdown(Vditor)**: Используется для хранения Markdown и его отображения с помощью редактора Vditor, поддерживает общий синтаксис Markdown, такой как списки, код, цитаты и т.д., и поддерживает загрузку изображений, записей и т.п. Также позволяет отображать результат мгновенно в режиме «что вижу, то и получаю».

Давайте шаг за шагом пройдемся по включению этого мощного редактора. Помните наш менеджер плагинов? Именно там он находится!

1. **Включение плагина Markdown (Vditor)**:
   - Откройте **Менеджер плагинов** в правом верхнем углу, найдите "markdown" в списке плагинов и включите [**Markdown (Vditor)**](https://docs.nocobase.com/handbook/field-markdown-vditor). Не беспокойтесь, если страница ненадолго обновится — она вернется через несколько секунд.

![Включение плагина Markdown](https://static-docs.nocobase.com/Solution/181734187638202414224712.png)

2. **Создание поля Markdown**:
   - Вернитесь в коллекцию задач, нажмите «Добавить поле», и наш Markdown Pro Plus готов к работе!

![](https://static-docs.nocobase.com/Solution/391734187779202414224912.png)

- Дайте ему имя, например, «Детали задачи (task_detail)», и включите все доступные функции.

3. Вы можете заметить опцию «Коллекция файлов». Интересует, повлияет ли ее невыбор на функциональность файлов? Не беспокойтесь; файлы будут храниться в нашем хранилище по умолчанию, так что смело используйте его.

![](https://static-docs.nocobase.com/Solution/281734187948202414225212.png)

4. **Тестирование поля Markdown**:
   - Теперь вернитесь на страницу управления задачами и начните создавать свой первый Markdown-текст! Попробуйте вставить изображение или загрузить файл — это довольно мощно, не правда ли?

![](https://static-docs.nocobase.com/Solution/551734188155202414225512.png)

Ваша коллекция задач становится все более функциональной! С каждым шагом возможности вашей системы расширяются. Далее давайте рассмотрим настройку расположения полей для более удобного интерфейса.

### 4.1.2 Настройка макета полей

По мере увеличения количества полей в коллекции задач макет страницы может казаться загроможденным. Не стоит беспокоиться, так как гибкость NocoBase позволяет легко пережвигать поля.

**Настройка позиций полей**:

- Наведите курсор на значок крестика в правом верхнем углу поля, затем нажмите и перетащите его в нужное положение. Отпустите, чтобы завершить настройку. Страница мгновенно становится аккуратнее, не так ли?

![Настройка позиций полей](https://static-docs.nocobase.com/Solution/demoE3v1-16.gif)

Это делает макет более соответствующим вашим предпочтениям. Теперь давайте добавим функцию комментариев в коллекцию задач, чтобы сделать совместную работу команды еще проще.

## 4.2 Функция комментариев

Наличие описания задачи полезно, но иногда членам команды нужно добавлять комментарии, обсуждать проблемы и записывать отзывы. Давайте начнем реализовывать это вместе.

### 4.2.1 Способ первый: Использование плагина комментариев

#### 4.2.1.1 Установка плагина комментариев

> **Плагин комментариев (Коммерческий плагин):** Предоставляет шаблон коллекции комментариев и блок для добавления функциональности комментирования к любой коллекции.
>
> Примечание: При добавлении комментариев обязательно свяжите целевую коллекцию через поле связи, чтобы предотвратить конфликты данных комментариев.

В [**Менеджере плагинов**](https://docs.nocobase.com/handbook/plugin-manager) загрузите и включите **Плагин комментариев**. После включения плагина в источнике данных появится новая опция «Коллекция комментариев». Нажмите «Добавить новый (Добавить и обновить)» > «Загрузить плагин» > «Перетащите zip-файл» > «Отправить». После поиска "comments" вы увидите плагин комментариев! После его включения войдите в источник данных и увидите опцию Коллекция комментариев — установка успешна!

![Установка плагина комментариев](https://static-docs.nocobase.com/Solution/demoE3v1-17.gif)

![Просмотр плагина комментариев](https://static-docs.nocobase.com/Solution/demoE3v1-18.gif)

#### 4.2.1.2 Создание коллекции комментариев

Переключитесь в источник данных и создайте новую коллекцию данных комментариев под названием **Комментарии**.

#### 4.2.1.3 Исследование связи между коллекциями комментариев и задач

Теперь, когда у нас есть **Коллекция комментариев**, вам может быть интересно, можем ли мы просто добавить раздел комментариев на страницу. Не так быстро — давайте сначала подумаем: **У каждой задачи должен быть свой собственный раздел комментариев**, и связь между комментариями и задачами должна быть **многие-к-одному**. Итак, как нам связать комментарии с задачами?

Мы будем использовать [**поле связи**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations) для создания этого соединения в NocoBase.

NocoBase позволяет нам использовать поля связи для установки связей между коллекциями на уровне данных, подобно построению мостов, которые тесно соединяют связанные данные.

![](https://static-docs.nocobase.com/Solution/demoE3v1-19N.gif)

**Почему связь многие-к-одному?**

Почему мы выбираем связь [**многие-к-одному**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations/m2o) вместо [**один-ко-многим**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations/o2m) или другого типа? Подумайте: **Каждая задача может иметь несколько комментариев**, поэтому несколько комментариев могут указывать на одну и ту же задачу. Для этого мы создадим поле **многие-к-одному** в коллекции комментариев, которое связывает комментарии с задачами в коллекции задач.

> Вам могла прийти умная мысль:
> Поскольку комментарии и задачи имеют связь многие-к-одному, можем ли мы также создать поле **один-ко-многим** в коллекции задач, которое указывает на коллекцию комментариев?
> **Именно так!** Связи один-ко-многим и многие-к-одному являются взаимными, поэтому мы можем создать поле один-ко-многим в коллекции задач, которое связывает ее с коллекцией комментариев. У вас отлично получается!

#### 4.2.1.4 Настройка поля связи многие-к-одному

Далее создадим поле многие-к-одному в коллекции комментариев, чтобы связать ее с коллекцией задач. Мы можем назвать это поле **Связанная задача (belong_task)**. Во время конфигурации обратите внимание на эти ключевые настройки:

1.  **Исходная коллекция**: Откуда инициируется связь? В этом случае это **Коллекция комментариев**.
2.  **Целевая коллекция**: С какой коллекцией мы связываем? Здесь это **Коллекция задач**.

> **Пример для внешних ключей и идентификации поля целевой коллекции:**
> Давайте проясним на примере:
>
> Представьте, что вы обрабатываете стопку табелей успеваемости старшеклассников, и ваша задача — связать каждый табель с учеником, которому он принадлежит. Допустим, в табеле есть следующая информация:
>
> - **Имя**: Иван Иванов
> - **Класс**: 11 "А"
> - **Экзаменационный ID**: 202300000001
> - **Номер паспорта**: 111111111111
>
> Теперь предположим, что вы хотите использовать **Имя** и **Класс**, чтобы найти Ивана Иванова. Однако, поскольку в одном классе может быть много учеников с именем Иван Иванов, точно идентифицировать их может быть сложно.
>
> **Вот где уникальный идентификатор, такой как Экзаменационный ID, становится полезным**. Используя экзаменационный ID, вы можете точно идентифицировать табель каждого ученика. Например, если вы выполните поиск по экзаменационному ID «202300000001», школа быстро ответит: «Этот табель принадлежит Ивану Иванову, тому, что в очках, на третьей парте в 11 "А"».
>
> Та же логика применима к настройке связи **комментариев**. Уникальный идентификатор из коллекции задач, такой как **ID**, может быть сохранен в комментариях, чтобы связать каждый комментарий с соответствующей задачей.
>
> Эта концепция **внешних ключей** является ядром реализации связей многие-к-одному — просто, не так ли?

В коллекции комментариев мы сохраняем уникальное поле **task_id** из коллекции задач, привязывая комментарии к связанным с ними задачам.

#### 4.2.1.5 Обработка внешних ключей при удалении

После настройки связи многие-к-одному в NocoBase нам также нужно подумать, что произойдет с комментариями, если задача будет удалена. У вас есть несколько вариантов:

- **CASCADE (Каскадное удаление)**: Когда задача удаляется, все связанные с ней комментарии также удаляются.
- **SET NULL (Установить NULL)** (настройка по умолчанию): Когда задача удаляется, данные комментариев сохраняются, но поле внешнего ключа устанавливается в NULL.
- **RESTRICT и NO ACTION (Запретить и Без действия)**: Если у задачи есть связанные комментарии, система предотвратит ее удаление, гарантируя, что ни один комментарий не будет потерян.

#### 4.2.1.6 Создание обратных связей в коллекции задач

Наконец, выберите **Создать поле обратной связи в целевой коллекции**, чтобы упростить просмотр всех связанных комментариев непосредственно из задачи. Это повышает эффективность управления данными.

Расположение полей связи в NocoBase определяет, как осуществляется доступ к данным. Чтобы сделать комментарии видимыми непосредственно из коллекции задач, мы создадим поле обратной связи **один-ко-многим** в коллекции задач, связывающее ее с коллекцией комментариев.

Когда вы снова откроете коллекцию задач, вы увидите поле комментариев, помеченное связью **один-ко-многим**, которое позволяет вам легко просматривать и управлять всеми связанными комментариями!

## 4.3 Настройка страницы

### 4.3.1 Включение коллекции комментариев

Теперь наступает волнительный момент: вернитесь во всплывающее окно редактирования, создайте **блок комментариев** и проверьте нужные функции. Готово!

![Включение коллекции комментариев](https://static-docs.nocobase.com/Solution/demoE3v1-20.gif)

### 4.3.2 Настройка страницы

Давайте стилизуем макет страницы. Наведите курсор на правый верхний угол кнопки редактирования, выберите более широкое всплывающее окно и используйте полученные знания, чтобы перетащить блок комментариев в правую часть всплывающего окна. Идеально!

![Настройка макета страницы](https://static-docs.nocobase.com/Solution/demoE3v1-21.gif)

Некоторые из вас, возможно, задаются вопросом: «Я тоже хочу настроить комментарии!» Не волнуйтесь; у меня для вас подготовлен еще один бесплатный вариант.

### 4.2.2 Способ второй: Создание пользовательской коллекции комментариев

Если вы не приобрели плагин комментариев, мы все равно можем настроить аналогичную функцию комментариев, создав пользовательскую коллекцию.

1.  **Создание новой коллекции комментариев**:

    - Создайте **Коллекцию комментариев (comments2)**, добавьте поле **Содержание комментария (content)** (тип Markdown) и поле **Связанная задача (belong_task)** (тип многие-к-одному).
      ![](https://static-docs.nocobase.com/Solution/431734190783202414233912.png)
2.  **Создание блока списка комментариев на странице**:

    - Во всплывающем окне редактирования для коллекции задач добавьте [**Блок списка**](https://docs.nocobase.com/handbook/ui/blocks/data-blocks/list) (наш третий тип блока, который может отображать детали полей), выберите комментарии и протестируйте его:
      ![Создание блока списка комментариев](https://static-docs.nocobase.com/Solution/demoE3v1-22N%20-1.gif)
      ![Создание блока списка комментариев-2](https://static-docs.nocobase.com/Solution/demoE3v1-22N%20-2.gif)

## Резюме

Теперь вы знаете, как расширить возможности задач с помощью Markdown (Vditor) и добавить функцию комментариев к задачам! Ваша система управления задачами уже располагает функциональным фундаментом — вы на шаг ближе к созданию профессионального инструмента управления задачами!

Продолжайте экспериментировать и практиковаться; возможности NocoBase действительно безграничны!  Если вы столкнетесь с какими-либо проблемами, не волнуйтесь — я буду здесь, чтобы направлять вас на каждом шагу.

В [следующей главе (Глава 5: Вкладки и динамические блоки)](https://www.nocobase.com/en/tutorials/task-tutorial-tabs-blocks) мы углубимся в дополнительные функции блоков в NocoBase, помогая вам вывести вашу систему на следующий уровень. Продолжайте в том же духе!

---

Воплощайте свои идеи без ограничений! Если вы столкнетесь с какими-либо трудностями, не стесняйтесь обращаться к [Официальной документации NocoBase](https://docs-cn.nocobase.com/) или присоединяйтесь к [Сообществу NocoBase](https://forum.nocobase.com/) для обсуждений.