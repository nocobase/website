---
import { createAvatar } from '@dicebear/core';
import * as nocobaseAvatars from '@nocobase/ai-employee-avatars';

// AI Employee name to avatar mapping
const AI_EMPLOYEE_AVATARS: Record<string, { displayName: string; avatar: string }> = {
  // CRM AI Employees
  dex: { displayName: 'Dex', avatar: 'nocobase-015-male' },
  orin: { displayName: 'Orin', avatar: 'nocobase-055-male' },
  nathan: { displayName: 'Nathan', avatar: 'nocobase-002-male' },
  viz: { displayName: 'Viz', avatar: 'nocobase-010-male' },
  lexi: { displayName: 'Lexi', avatar: 'nocobase-051-female' },
  vera: { displayName: 'Vera', avatar: 'nocobase-027-female' },
  cole: { displayName: 'Cole', avatar: 'nocobase-036-female' },
  ellis: { displayName: 'Ellis', avatar: 'nocobase-057-female' },
  dara: { displayName: 'Dara', avatar: 'nocobase-048-female' },
  // Ticket System AI Employees
  grace: { displayName: 'Grace', avatar: 'nocobase-052-female' },
  max: { displayName: 'Max', avatar: 'nocobase-034-female' },
  sam: { displayName: 'Sam', avatar: 'nocobase-006-male' },
  // Legacy aliases (for backward compatibility)
  alex: { displayName: 'Alex', avatar: 'nocobase-032-male' },
  'orin-green': { displayName: 'Orin', avatar: 'nocobase-011-male' },
};

// NocoBase Avatar Map (from plugin-ai)
const avatarsMap: Record<string, any> = {
  'nocobase-001-male': {
    seed: 'nocobase-001-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man002'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-002-male': {
    seed: 'nocobase-002-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man001'],
    mouth: ['unisex001'],
    clothes: ['unisex016'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-003-female': {
    seed: 'nocobase-003-female',
    gender: 'female',
    base: ['purple'],
    hair: ['woman012'],
    mouth: ['unisex001'],
    clothes: ['unisex002'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-004-male': {
    seed: 'nocobase-004-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man004'],
    mouth: ['unisex001'],
    clothes: ['unisex015'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-005-female': {
    seed: 'nocobase-005-female',
    gender: 'female',
    base: ['purple'],
    hair: ['woman008'],
    mouth: ['unisex001'],
    clothes: ['unisex007'],
    earing: ['woman004'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-006-male': {
    seed: 'nocobase-006-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man007'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-007-male': {
    seed: 'nocobase-007-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man003'],
    mouth: ['unisex001'],
    clothes: ['unisex006'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-008-female': {
    seed: 'nocobase-008-female',
    gender: 'female',
    base: ['purple'],
    hair: ['woman004'],
    mouth: ['unisex001'],
    clothes: ['woman003'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-009-female': {
    seed: 'nocobase-009-female',
    gender: 'female',
    base: ['purple'],
    hair: ['woman004'],
    mouth: ['unisex001'],
    clothes: ['woman002'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-010-male': {
    seed: 'nocobase-010-male',
    gender: 'male',
    base: ['purple'],
    hair: ['man006'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-011-male': {
    seed: 'nocobase-011-male',
    gender: 'male',
    base: ['green'],
    hair: ['man006'],
    mouth: ['unisex001'],
    clothes: ['unisex016'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-012-male': {
    seed: 'nocobase-012-male',
    gender: 'male',
    base: ['green'],
    hair: ['man007'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-013-female': {
    seed: 'nocobase-013-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman012'],
    mouth: ['unisex001'],
    clothes: ['unisex010'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-014-female': {
    seed: 'nocobase-014-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman002'],
    mouth: ['unisex001'],
    clothes: ['unisex014'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-015-male': {
    seed: 'nocobase-015-male',
    gender: 'male',
    base: ['green'],
    hair: ['man002'],
    mouth: ['unisex001'],
    clothes: ['unisex013'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-016-female': {
    seed: 'nocobase-016-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman009'],
    mouth: ['unisex001'],
    clothes: ['unisex003'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-017-female': {
    seed: 'nocobase-017-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman010'],
    mouth: ['unisex001'],
    clothes: ['woman003'],
    earing: ['woman001'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-018-female': {
    seed: 'nocobase-018-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman006'],
    mouth: ['unisex001'],
    clothes: ['unisex014'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-019-female': {
    seed: 'nocobase-019-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman005'],
    mouth: ['unisex001'],
    clothes: ['unisex001'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-020-female': {
    seed: 'nocobase-020-female',
    gender: 'female',
    base: ['green'],
    hair: ['woman011'],
    mouth: ['unisex001'],
    clothes: ['unisex006'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-021-male': {
    seed: 'nocobase-021-male',
    gender: 'male',
    base: ['red'],
    hair: ['man006'],
    mouth: ['unisex001'],
    clothes: ['unisex007'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-022-male': {
    seed: 'nocobase-022-male',
    gender: 'male',
    base: ['red'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex006'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-023-female': {
    seed: 'nocobase-023-female',
    gender: 'female',
    base: ['red'],
    hair: ['woman006'],
    mouth: ['unisex001'],
    clothes: ['unisex006'],
    earing: ['woman001'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-024-male': {
    seed: 'nocobase-024-male',
    gender: 'male',
    base: ['red'],
    hair: ['man001'],
    mouth: ['unisex001'],
    clothes: ['unisex002'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-025-male': {
    seed: 'nocobase-025-male',
    gender: 'male',
    base: ['red'],
    hair: ['man006'],
    mouth: ['unisex001'],
    clothes: ['unisex006'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-026-male': {
    seed: 'nocobase-026-male',
    gender: 'male',
    base: ['red'],
    hair: ['man002'],
    mouth: ['unisex001'],
    clothes: ['unisex016'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-027-female': {
    seed: 'nocobase-027-female',
    gender: 'female',
    base: ['red'],
    hair: ['woman003'],
    mouth: ['unisex001'],
    clothes: ['unisex009'],
    earing: ['woman005'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-028-male': {
    seed: 'nocobase-028-male',
    gender: 'male',
    base: ['red'],
    hair: ['man003'],
    mouth: ['unisex001'],
    clothes: ['unisex012'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-029-male': {
    seed: 'nocobase-029-male',
    gender: 'male',
    base: ['red'],
    hair: ['man007'],
    mouth: ['unisex001'],
    clothes: ['unisex011'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-030-male': {
    seed: 'nocobase-030-male',
    gender: 'male',
    base: ['red'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex015'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-031-female': {
    seed: 'nocobase-031-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman006'],
    mouth: ['unisex001'],
    clothes: ['woman003'],
    earing: ['woman002'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-032-male': {
    seed: 'nocobase-032-male',
    gender: 'male',
    base: ['brown'],
    hair: ['man004'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-033-male': {
    seed: 'nocobase-033-male',
    gender: 'male',
    base: ['brown'],
    hair: ['man001'],
    mouth: ['unisex001'],
    clothes: ['unisex016'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-034-female': {
    seed: 'nocobase-034-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman011'],
    mouth: ['unisex001'],
    clothes: ['woman003'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-035-male': {
    seed: 'nocobase-035-male',
    gender: 'male',
    base: ['brown'],
    hair: ['man001'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-036-female': {
    seed: 'nocobase-036-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman012'],
    mouth: ['unisex001'],
    clothes: ['woman002'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-037-male': {
    seed: 'nocobase-037-male',
    gender: 'male',
    base: ['brown'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-038-female': {
    seed: 'nocobase-038-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman008'],
    mouth: ['unisex001'],
    clothes: ['woman001'],
    earing: ['woman002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-039-female': {
    seed: 'nocobase-039-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman010'],
    mouth: ['unisex001'],
    clothes: ['unisex005'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-040-female': {
    seed: 'nocobase-040-female',
    gender: 'female',
    base: ['brown'],
    hair: ['woman010'],
    mouth: ['unisex001'],
    clothes: ['unisex001'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-041-male': {
    seed: 'nocobase-041-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man006'],
    mouth: ['unisex001'],
    clothes: ['unisex011'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-042-male': {
    seed: 'nocobase-042-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man003'],
    mouth: ['unisex001'],
    clothes: ['unisex014'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-043-male': {
    seed: 'nocobase-043-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man003'],
    mouth: ['unisex001'],
    clothes: ['unisex014'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-044-male': {
    seed: 'nocobase-044-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man008'],
    mouth: ['unisex001'],
    clothes: ['unisex002'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-045-female': {
    seed: 'nocobase-045-female',
    gender: 'female',
    base: ['blue'],
    hair: ['woman003'],
    mouth: ['unisex001'],
    clothes: ['woman004'],
    earing: ['woman005'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-046-female': {
    seed: 'nocobase-046-female',
    gender: 'female',
    base: ['blue'],
    hair: ['woman001'],
    mouth: ['unisex001'],
    clothes: ['unisex015'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-047-male': {
    seed: 'nocobase-047-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man007'],
    mouth: ['unisex001'],
    clothes: ['unisex001'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-048-female': {
    seed: 'nocobase-048-female',
    gender: 'female',
    base: ['blue'],
    hair: ['woman007'],
    mouth: ['unisex001'],
    clothes: ['unisex009'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-049-male': {
    seed: 'nocobase-049-male',
    gender: 'male',
    base: ['blue'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex005'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-050-female': {
    seed: 'nocobase-050-female',
    gender: 'female',
    base: ['blue'],
    hair: ['woman001'],
    mouth: ['unisex001'],
    clothes: ['unisex013'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-051-female': {
    seed: 'nocobase-051-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman001'],
    mouth: ['unisex001'],
    clothes: ['unisex002'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-052-female': {
    seed: 'nocobase-052-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman002'],
    mouth: ['unisex001'],
    clothes: ['unisex008'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-053-male': {
    seed: 'nocobase-053-male',
    gender: 'male',
    base: ['yellow'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex015'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-054-female': {
    seed: 'nocobase-054-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman012'],
    mouth: ['unisex001'],
    clothes: ['unisex015'],
    earing: undefined,
    earingProbability: 0,
    glasses: ['unisex001'],
    glassesProbability: 100,
  },
  'nocobase-055-male': {
    seed: 'nocobase-055-male',
    gender: 'male',
    base: ['yellow'],
    hair: ['man003'],
    mouth: ['unisex001'],
    clothes: ['unisex001'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-056-female': {
    seed: 'nocobase-056-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman002'],
    mouth: ['unisex001'],
    clothes: ['unisex011'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: ['unisex002'],
    glassesProbability: 100,
  },
  'nocobase-057-female': {
    seed: 'nocobase-057-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman009'],
    mouth: ['unisex001'],
    clothes: ['unisex004'],
    earing: ['woman005'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-058-female': {
    seed: 'nocobase-058-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman010'],
    mouth: ['unisex001'],
    clothes: ['unisex008'],
    earing: ['unisex002'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-059-male': {
    seed: 'nocobase-059-male',
    gender: 'male',
    base: ['yellow'],
    hair: ['man005'],
    mouth: ['unisex001'],
    clothes: ['unisex008'],
    earing: ['unisex001'],
    earingProbability: 100,
    glasses: undefined,
    glassesProbability: 0,
  },
  'nocobase-060-female': {
    seed: 'nocobase-060-female',
    gender: 'female',
    base: ['yellow'],
    hair: ['woman012'],
    mouth: ['unisex001'],
    clothes: ['woman004'],
    earing: undefined,
    earingProbability: 0,
    glasses: undefined,
    glassesProbability: 0,
  },
};

// Generate NocoBase avatar SVG
function generateNocobaseAvatar(avatarId: string): string {
  const config = avatarsMap[avatarId];
  if (!config) return '';
  const avatar = createAvatar(nocobaseAvatars, {
    ...config,
    mask: undefined,
    scale: 100,
  });
  return avatar.toDataUri();
}

// Resolve avatar name to display name and SVG
function resolveAvatar(name: string): { displayName: string; svg: string } {
  // Check if it's a direct nocobase avatar ID (e.g., "nocobase-055-male")
  if (name.startsWith('nocobase-') && avatarsMap[name]) {
    return {
      displayName: name,
      svg: generateNocobaseAvatar(name),
    };
  }

  // Check if it's an AI employee name (e.g., "orin", "viz")
  const employee = AI_EMPLOYEE_AVATARS[name.toLowerCase()];
  if (employee) {
    return {
      displayName: employee.displayName,
      svg: generateNocobaseAvatar(employee.avatar),
    };
  }

  throw new Error(`Avatar "${name}" not found in AI_AVATARS configuration`);
}

interface Props {
  name: string;
  class?: string;
}

const { name, class: className = '' } = Astro.props;
const avatar = resolveAvatar(name);
---

<a
  href="javascript:void"
  class="avatar-tips avatar-container"
  data-bs-toggle="tooltip"
  data-bs-placement="top"
  title={avatar.displayName}
>
  <img
    class={`demo-title-ai-avatar ${className}`.trim()}
    src={avatar.svg}
    alt={avatar.displayName}
  />
</a>
